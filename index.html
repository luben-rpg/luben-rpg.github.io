<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador IA Avanzado - LÃ³gica Proposicional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --info: #3498db;
            --ai-bubble: #e3f2fd;
            --user-bubble: #f0f4f8;
            --learning: #9b59b6;
            --reading: #16a085;
            --formula: #8e44ad;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            grid-template-areas: 
                "header header"
                "problem assistant"
                "footer footer";
        }
        
        header {
            grid-area: header;
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: relative;
        }
        
        .learning-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--learning);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .problem-section {
            grid-area: problem;
            padding: 20px;
            background: var(--light);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .assistant-section {
            grid-area: assistant;
            padding: 20px;
            background: white;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #eee;
            position: relative;
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
        }
        
        .exercise {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .exercise-content {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid var(--secondary);
        }
        
        .input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            border-color: var(--secondary);
            outline: none;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: var(--success);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-danger {
            background: var(--accent);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-learning {
            background: var(--learning);
            color: white;
        }
        
        .btn-learning:hover {
            background: #8e44ad;
        }
        
        .btn-reading {
            background: var(--reading);
            color: white;
        }
        
        .btn-reading:hover {
            background: #1abc9c;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .upload-area:hover {
            border-color: var(--secondary);
            background-color: #f8f9fa;
        }
        
        .upload-area.drag-over {
            border-color: var(--secondary);
            background-color: #e3f2fd;
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #7f8c8d;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 15px;
            border-radius: 8px;
            display: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            max-height: 400px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .message {
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .ai-message {
            align-self: flex-start;
            background: var(--ai-bubble);
            border-bottom-left-radius: 4px;
        }
        
        .user-message {
            align-self: flex-end;
            background: var(--user-bubble);
            border-bottom-right-radius: 4px;
        }
        
        .message-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .message-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 20px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .message-input input:focus {
            border-color: var(--secondary);
        }
        
        .send-btn {
            background: var(--secondary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .send-btn:hover {
            background: #2980b9;
        }
        
        .solution-step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .step-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .correct {
            border-left: 4px solid var(--success);
        }
        
        .incorrect {
            border-left: 4px solid var(--accent);
        }
        
        .feedback {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: #ffeaa7;
            border-left: 4px solid var(--warning);
        }
        
        .truth-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .truth-table th, .truth-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .truth-table th {
            background: var(--primary);
            color: white;
        }
        
        .truth-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .circuit-diagram {
            font-family: monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            white-space: pre;
            overflow-x: auto;
        }
        
        footer {
            grid-area: footer;
            text-align: center;
            padding: 20px;
            background: var(--dark);
            color: white;
        }
        
        .analysis-progress {
            height: 5px;
            width: 100%;
            background: #eee;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: var(--secondary);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        
        .exercise-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .exercise-type-btn {
            padding: 8px 15px;
            background: #e0e0e0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .exercise-type-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        .hint-box {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid var(--info);
        }
        
        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        .feedback-btn {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .feedback-btn:hover {
            background: #e0e0e0;
        }
        
        .feedback-btn.helpful {
            color: var(--success);
        }
        
        .feedback-btn.not-helpful {
            color: var(--accent);
        }
        
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .suggestion-chip {
            padding: 8px 15px;
            background: #e3f2fd;
            border-radius: 18px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .suggestion-chip:hover {
            background: #d0e5fc;
        }
        
        .user-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .progress-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .progress-tracker {
            flex: 1;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-value {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }
        
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "problem"
                    "assistant"
                    "footer";
            }
            
            .assistant-section {
                border-left: none;
                border-top: 1px solid #eee;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
        
        .typing-indicator {
            display: flex;
            padding: 10px;
            background: var(--ai-bubble);
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 10px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            margin: 0 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        .learning-notice {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--learning);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s;
        }
        
        .learning-notice.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Estilos para el mÃ³dulo de lectura */
        .reading-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .reading-content {
            background: white;
            width: 90%;
            max-width: 1000px;
            height: 80%;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        }
        
        .reading-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-reading {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .reading-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .book-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #eee;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .book-content h3 {
            color: var(--primary);
            margin: 20px 0 10px;
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 5px;
        }
        
        .book-content p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        .book-content .important {
            background: #fff9e6;
            padding: 10px 15px;
            border-left: 4px solid var(--warning);
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .book-content .definition {
            background: #e8f4fd;
            padding: 10px 15px;
            border-left: 4px solid var(--info);
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .book-content .example {
            background: #f0f9f0;
            padding: 10px 15px;
            border-left: 4px solid var(--success);
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .ia-assistance {
            width: 300px;
            padding: 15px;
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .ia-explanation {
            background: var(--ai-bubble);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }
        
        .ia-suggestions {
            margin-top: 15px;
        }
        
        .suggestion-item {
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid var(--reading);
        }
        
        .suggestion-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }
        
        .chapter-nav {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: #f5f5f5;
            border-top: 1px solid #eee;
        }
        
        .nav-btn {
            padding: 8px 15px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .bookmark-btn {
            background: var(--reading);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .reading-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .control-btn {
            padding: 8px 12px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .control-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        /* Nuevos estilos para el Ã¡rea de fÃ³rmulas */
        .formula-input-container {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--formula);
        }
        
        .formula-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .formula-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
        }
        
        .formula-input input:focus {
            border-color: var(--formula);
            outline: none;
        }
        
        .formula-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .formula-btn {
            padding: 8px 12px;
            background: #e0e0e0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }
        
        .formula-btn:hover {
            background: #d0d0d0;
        }
        
        .formula-examples {
            margin-top: 15px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .formula-examples h4 {
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .example-chip {
            display: inline-block;
            padding: 5px 10px;
            margin: 0 5px 5px 0;
            background: white;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .example-chip:hover {
            background: #d0e5fc;
        }
        
        .formula-result {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .simplified-formula {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            padding: 10px;
            background: #f0f9f0;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid var(--success);
        }
        
        .evaluation-steps {
            margin-top: 15px;
        }
        
        .step {
            padding: 8px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        
        .evaluation-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        .evaluation-table th, .evaluation-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .evaluation-table th {
            background: var(--primary);
            color: white;
        }
        
        .symbol-guide {
            margin-top: 15px;
            padding: 10px;
            background: #fff9e6;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .symbol-item {
            display: inline-block;
            margin-right: 15px;
        }
        
        .symbol {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: var(--formula);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="learning-badge">
                <i class="fas fa-brain"></i> IA con Aprendizaje
            </div>
            <h1><i class="fas fa-robot"></i> Analizador IA Avanzado - LÃ³gica Proposicional</h1>
            <p class="subtitle">IA mejorada que resuelve ejercicios propuestos paso a paso</p>
            <button class="btn-reading" onclick="openReadingModal()">
                <i class="fas fa-book"></i> Leer Libro con Asistencia IA
            </button>
        </header>
        
        <div class="problem-section">
            <h2><i class="fas fa-pencil-alt"></i> Ejercicio Actual</h2>
            
            <div class="exercise-selector">
                <button class="exercise-type-btn active" onclick="changeExerciseType('basic')">BÃ¡sico</button>
                <button class="exercise-type-btn" onclick="changeExerciseType('truth-table')">Tablas de Verdad</button>
                <button class="exercise-type-btn" onclick="changeExerciseType('circuit')">Circuitos LÃ³gicos</button>
                <button class="exercise-type-btn" onclick="changeExerciseType('formula')">Resolver FÃ³rmula</button>
            </div>
            
            <div class="exercise">
                <h3>Problema #1 <span class="exercise-difficulty">(BÃ¡sico)</span></h3>
                <div class="exercise-content">
                    Dadas las proposiciones:
                    p: "5 es un nÃºmero primo"
                    q: "4 < 2"
                    
                    Determine el valor de verdad de:
                    p â§ q, p â¨ q, p â q
                </div>
                
                <div class="hint-box">
                    <strong><i class="fas fa-lightbulb"></i> Sugerencia:</strong> Recuerda que una conjunciÃ³n (â§) es verdadera solo cuando ambas proposiciones son verdaderas.
                </div>
            </div>
            
            <!-- Nuevo contenedor para entrada de fÃ³rmulas (inicialmente oculto) -->
            <div id="formula-input-container" style="display: none;">
                <h3><i class="fas fa-square-root-alt"></i> Resolver FÃ³rmula LÃ³gica</h3>
                
                <div class="formula-input">
                    <input type="text" id="formulaInput" placeholder="Ingresa la fÃ³rmula lÃ³gica (ej: p â§ q, Â¬p â¨ q, p â q)">
                    <button class="btn-primary" onclick="analyzeFormula()">
                        <i class="fas fa-calculator"></i> Analizar
                    </button>
                </div>
                
                <div class="formula-buttons">
                    <button class="formula-btn" onclick="insertSymbol('Â¬')">Â¬ (NO)</button>
                    <button class="formula-btn" onclick="insertSymbol('â§')">â§ (Y)</button>
                    <button class="formula-btn" onclick="insertSymbol('â¨')">â¨ (O)</button>
                    <button class="formula-btn" onclick="insertSymbol('â')">â (ENTONCES)</button>
                    <button class="formula-btn" onclick="insertSymbol('â')">â (SI Y SOLO SI)</button>
                    <button class="formula-btn" onclick="insertSymbol('(')">(</button>
                    <button class="formula-btn" onclick="insertSymbol(')')">)</button>
                </div>
                
                <div class="symbol-guide">
                    <strong>GuÃ­a de sÃ­mbolos:</strong>
                    <div class="symbol-item"><span class="symbol">Â¬</span> NegaciÃ³n</div>
                    <div class="symbol-item"><span class="symbol">â§</span> ConjunciÃ³n (Y)</div>
                    <div class="symbol-item"><span class="symbol">â¨</span> DisyunciÃ³n (O)</div>
                    <div class="symbol-item"><span class="symbol">â</span> Condicional (Entonces)</div>
                    <div class="symbol-item"><span class="symbol">â</span> Bicondicional (Si y solo si)</div>
                </div>
                
                <div class="formula-examples">
                    <h4>Ejemplos para probar:</h4>
                    <div class="example-chip" onclick="setFormulaExample('p â§ q')">p â§ q</div>
                    <div class="example-chip" onclick="setFormulaExample('Â¬p â¨ q')">Â¬p â¨ q</div>
                    <div class="example-chip" onclick="setFormulaExample('p â q')">p â q</div>
                    <div class="example-chip" onclick="setFormulaExample('(p â¨ q) â§ Â¬p')">(p â¨ q) â§ Â¬p</div>
                    <div class="example-chip" onclick="setFormulaExample('p â (q â¨ r)')">p â (q â¨ r)</div>
                </div>
                
                <div id="formulaResult" class="formula-result" style="display: none;">
                    <!-- AquÃ­ se mostrarÃ¡n los resultados del anÃ¡lisis -->
                </div>
            </div>
            
            <div class="input-area">
                <h3><i class="fas fa-edit"></i> Tu respuesta:</h3>
                <textarea id="userSolution" placeholder="Escribe tu soluciÃ³n paso a paso aquÃ­..."></textarea>
                
                <div class="buttons">
                    <button class="btn-primary" onclick="checkSolution()">
                        <i class="fas fa-check-circle"></i> Verificar soluciÃ³n
                    </button>
                    <button class="btn-secondary" onclick="showSolution()">
                        <i class="fas fa-eye"></i> Mostrar soluciÃ³n
                    </button>
                    <button class="btn-warning" onclick="newExercise()">
                        <i class="fas fa-plus-circle"></i> Nuevo ejercicio
                    </button>
                    <button class="btn-learning" onclick="adaptiveExplanation()">
                        <i class="fas fa-graduation-cap"></i> ExplicaciÃ³n Adaptativa
                    </button>
                    <button class="btn-danger" onclick="clearAll()">
                        <i class="fas fa-trash"></i> Limpiar
                    </button>
                </div>
            </div>
            
            <div class="user-progress">
                <span class="progress-label">Tu progreso:</span>
                <div class="progress-tracker">
                    <div class="progress-value" id="progressValue" style="width: 0%"></div>
                </div>
                <span id="progressPercent">0%</span>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleImageUpload(this.files)">
                <div class="upload-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <p>Haz clic o arrastra una imagen de un ejercicio para analizarlo</p>
                <img id="imagePreview" class="image-preview" alt="Vista previa de la imagen">
                <div class="analysis-progress" id="progressBar">
                    <div class="progress-bar" id="progressFill"></div>
                </div>
            </div>
            
            <div class="feedback" id="feedbackSection">
                <h3><i class="fas fa-comment-dots"></i> RetroalimentaciÃ³n</h3>
                <p>AquÃ­ verÃ¡s el anÃ¡lisis de tu respuesta y correcciones si es necesario.</p>
            </div>
        </div>
        
        <div class="assistant-section">
            <div class="learning-notice" id="learningNotice">
                <i class="fas fa-sync-alt"></i> Aprendiendo de tu interacciÃ³n...
            </div>
            
            <h2><i class="fas fa-robot"></i> Asistente IA Avanzado</h2>
            
            <div class="chat-container" id="chatContainer">
                <div class="message ai-message">
                    Â¡Hola! Soy tu asistente avanzado de lÃ³gica proposicional. Ahora puedo resolver fÃ³rmulas lÃ³gicas que me proporciones. Escribe una fÃ³rmula o sube una imagen con un ejercicio.
                </div>
                <div class="message ai-message">
                    Puedes usar los sÃ­mbolos: Â¬ (negaciÃ³n), â§ (conjunciÃ³n), â¨ (disyunciÃ³n), â (condicional), â (bicondicional)
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" onclick="sendSuggestion('Â¿CÃ³mo analizar p â§ q?')">Â¿CÃ³mo analizar p â§ q?</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('ExplÃ­came las tablas de verdad')">ExplÃ­came las tablas de verdad</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('Necesito un ejemplo de circuito')">Necesito un ejemplo de circuito</div>
                    </div>
                </div>
            </div>
            
            <div class="message-input">
                <input type="text" id="userInput" placeholder="Escribe tu pregunta aquÃ­..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <footer>
            <p>Analizador IA Avanzado de LÃ³gica Proposicional - Basado en "Fundamentos de la MatemÃ¡tica" de Jorge SÃ¡enz</p>
        </footer>
    </div>

    <!-- Modal de lectura del libro -->
    <div class="reading-modal" id="readingModal">
        <div class="reading-content">
            <div class="reading-header">
                <h2><i class="fas fa-book"></i> Fundamentos de la MatemÃ¡tica - Jorge SÃ¡enz</h2>
                <button class="close-reading" onclick="closeReadingModal()">&times;</button>
            </div>
            <div class="reading-body">
                <div class="book-content" id="bookContent">
                    <!-- El contenido del libro se cargarÃ¡ aquÃ­ -->
                </div>
                <div class="ia-assistance">
                    <h3><i class="fas fa-robot"></i> Asistente de Lectura</h3>
                    <div class="ia-explanation" id="iaExplanation">
                        Selecciona un capÃ­tulo o tema para obtener explicaciones y sugerencias de estudio.
                    </div>
                    
                    <div class="reading-controls">
                        <button class="control-btn" onclick="changeExplanationLevel('basic')" id="btnBasic">BÃ¡sico</button>
                        <button class="control-btn active" onclick="changeExplanationLevel('normal')" id="btnNormal">Normal</button>
                        <button class="control-btn" onclick="changeExplanationLevel('advanced')" id="btnAdvanced">Avanzado</button>
                    </div>
                    
                    <div class="ia-suggestions">
                        <h4>Sugerencias de estudio:</h4>
                        <div class="suggestion-item" onclick="askQuestion('explicame este concepto')">
                            <i class="fas fa-question-circle"></i> Explicar este concepto
                        </div>
                        <div class="suggestion-item" onclick="askQuestion('ejemplo de este tema')">
                            <i class="fas fa-lightbulb"></i> Mostrar un ejemplo
                        </div>
                        <div class="suggestion-item" onclick="askQuestion('ejercicio relacionado')">
                            <i class="fas fa-pencil-alt"></i> Proponer un ejercicio
                        </div>
                        <div class="suggestion-item" onclick="askQuestion('aplicaciÃ³n prÃ¡ctica')">
                            <i class="fas fa-rocket"></i> AplicaciÃ³n prÃ¡ctica
                        </div>
                    </div>
                </div>
            </div>
            <div class="chapter-nav">
                <button class="nav-btn" id="prevChapter" onclick="changeChapter(-1)" disabled>
                    <i class="fas fa-arrow-left"></i> Anterior
                </button>
                <span id="currentChapter">CapÃ­tulo 1: LÃ³gica Proposicional</span>
                <button class="nav-btn" id="nextChapter" onclick="changeChapter(1)">
                    Siguiente <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Ejercicios predefinidos por tipo
        const exercises = {
            basic: [
                {
                    id: 1,
                    content: `Dadas las proposiciones:
p: "5 es un nÃºmero primo"
q: "4 < 2"
                        
Determine el valor de verdad de:
p â§ q, p â¨ q, p â q`,
                    solution: {
                        steps: [
                            "p: '5 es un nÃºmero primo' â Verdadero (1)",
                            "q: '4 < 2' â Falso (0)",
                            "p â§ q = 1 â§ 0 = 0 (Falso)",
                            "p â¨ q = 1 â¨ 0 = 1 (Verdadero)",
                            "p â q = 1 â 0 = 0 (Falso)"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `Dadas las proposiciones:
p: "Ï es un nÃºmero racional"
q: "â4 = 2"
                        
Determine el valor de verdad de:
p â¨ q, p â§ q, Â¬p`,
                    solution: {
                        steps: [
                            "p: 'Ï es un nÃºmero racional' â Falso (0)",
                            "q: 'â4 = 2' â Verdadero (1)",
                            "p â¨ q = 0 â¨ 1 = 1 (Verdadero)",
                            "p â§ q = 0 â§ 1 = 0 (Falso)",
                            "Â¬p = Â¬0 = 1 (Verdadero)"
                        ]
                    }
                }
            ],
            "truth-table": [
                {
                    id: 1,
                    content: `Construya la tabla de verdad para la proposiciÃ³n:
(p â¨ q) â§ Â¬p`,
                    solution: {
                        steps: [
                            "Primero identificamos las variables: p, q",
                            "Construimos las columnas para p, q, p â¨ q, Â¬p, y (p â¨ q) â§ Â¬p",
                            "Completamos todas las combinaciones posibles de valores de verdad",
                            "Evaluamos p â¨ q para cada combinaciÃ³n",
                            "Evaluamos Â¬p para cada combinaciÃ³n",
                            "Finalmente evaluamos (p â¨ q) â§ Â¬p"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `Construya la tabla de verdad para la proposiciÃ³n:
(p â q) â§ (q â p)`,
                    solution: {
                        steps: [
                            "Esta expresiÃ³n es equivalente a p â q (bicondicional)",
                            "La bicondicional es verdadera cuando p y q tienen el mismo valor de verdad",
                            "Construimos la tabla con todas las combinaciones de p y q",
                            "Evaluamos p â q para cada combinaciÃ³n",
                            "Evaluamos q â p para cada combinaciÃ³n",
                            "Finalmente evaluamos la conjunciÃ³n de ambos condicionales"
                        ]
                    }
                }
            ],
            circuit: [
                {
                    id: 1,
                    content: `DiseÃ±e el circuito lÃ³gico para la expresiÃ³n:
(p â§ q) â¨ (Â¬p â§ r)`,
                    solution: {
                        steps: [
                            "Identificamos las compuertas necesarias: AND, OR y NOT",
                            "DiseÃ±amos la parte (p â§ q) con una compuerta AND",
                            "DiseÃ±amos la parte (Â¬p â§ r) con un NOT seguido de una AND",
                            "Combinamos ambas partes con una compuerta OR",
                            "Dibujamos el diagrama completo del circuito"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `DiseÃ±e el circuito lÃ³gico para la expresiÃ³n:
Â¬(p â¨ q) â§ r`,
                    solution: {
                        steps: [
                            "Identificamos las compuertas necesarias: OR, NOT y AND",
                            "Primero diseÃ±amos (p â¨ q) con una compuerta OR",
                            "Aplicamos la negaciÃ³n Â¬(p â¨ q) con una compuerta NOT",
                            "Finalmente combinamos con r usando una compuerta AND",
                            "Dibujamos el diagrama completo del circuito"
                        ]
                    }
                }
            ]
        };

        // Contenido del libro "Fundamentos de la MatemÃ¡tica" de Jorge SÃ¡enz
        const bookContent = {
            chapter1: {
                title: "CapÃ­tulo 1: LÃ³gica Proposicional",
                content: `
                    <h3>1.1 Proposiciones</h3>
                    <p>Una <strong>proposiciÃ³n</strong> es una expresiÃ³n lingÃ¼Ã­stica que puede ser calificada como verdadera o falsa, pero no ambas cosas a la vez.</p>
                    
                    <div class="definition">
                        <strong>DefiniciÃ³n:</strong> Una proposiciÃ³n es un enunciado que tiene un valor de verdad bien definido, es decir, que es verdadero (V) o falso (F), pero no ambos.
                    </div>
                    
                    <div class="example">
                        <strong>Ejemplos de proposiciones:</strong>
                        <ul>
                            <li>"5 es un nÃºmero primo" â Verdadera</li>
                            <li>"4 es mayor que 10" â Falsa</li>
                            <li>"Quito es la capital de Ecuador" â Verdadera</li>
                        </ul>
                    </div>
                    
                    <div class="important">
                        <strong>Importante:</strong> No son proposiciones:
                        <ul>
                            <li>Preguntas: "Â¿QuÃ© hora es?"</li>
                            <li>Ãrdenes: "Abre la ventana"</li>
                            <li>Exclamaciones: "Â¡QuÃ© sorpresa!"</li>
                            <li>Enunciados vagos: "Ãl es alto" (depende de contexto)</li>
                        </ul>
                    </div>
                    
                    <h3>1.2 Conectivos LÃ³gicos</h3>
                    <p>Los conectivos lÃ³gicos son operadores que permiten formar proposiciones compuestas a partir de proposiciones simples.</p>
                    
                    <p><strong>ConjunciÃ³n (â§):</strong> Representa "y". La proposiciÃ³n p â§ q es verdadera solo cuando ambas proposiciones son verdaderas.</p>
                    
                    <p><strong>DisyunciÃ³n (â¨):</strong> Representa "o". La proposiciÃ³n p â¨ q es falsa solo cuando ambas proposiciones son falsas.</p>
                    
                    <p><strong>Condicional (â):</strong> Representa "si... entonces...". La proposiciÃ³n p â q es falsa solo cuando p es verdadera y q es falsa.</p>
                    
                    <p><strong>Bicondicional (â):</strong> Representa "si y solo si". La proposiciÃ³n p â q es verdadera cuando ambas proposiciones tienen el mismo valor de verdad.</p>
                    
                    <p><strong>NegaciÃ³n (Â¬):</strong> Invierte el valor de verdad de la proposiciÃ³n.</p>
                    
                    <h3>1.3 Tablas de Verdad</h3>
                    <p>Una tabla de verdad es una representaciÃ³n sistemÃ¡tica de todos los posibles valores de verdad de una proposiciÃ³n compuesta.</p>
                    
                    <div class="example">
                        <strong>Ejemplo: Tabla de verdad para p â§ q</strong>
                        <table class="truth-table">
                            <tr>
                                <th>p</th>
                                <th>q</th>
                                <th>p â§ q</th>
                            </tr>
                            <tr>
                                <td>V</td>
                                <td>V</td>
                                <td>V</td>
                            </tr>
                            <tr>
                                <td>V</td>
                                <td>F</td>
                                <td>F</td>
                            </tr>
                            <tr>
                                <td>F</td>
                                <td>V</td>
                                <td>F</td>
                            </tr>
                            <tr>
                                <td>F</td>
                                <td>F</td>
                                <td>F</td>
                            </tr>
                        </table>
                    </div>
                `
            },
            chapter2: {
                title: "CapÃ­tulo 2: Circuitos LÃ³gicos",
                content: `
                    <h3>2.1 Compuertas LÃ³gicas</h3>
                    <p>Las compuertas lÃ³gicas son dispositivos electrÃ³nicos que implementan las operaciones lÃ³gicas bÃ¡sicas.</p>
                    
                    <div class="definition">
                        <strong>Compuerta AND:</strong> Implementa la conjunciÃ³n lÃ³gica. Su salida es 1 solo cuando todas sus entradas son 1.
                    </div>
                    
                    <div class="definition">
                        <strong>Compuerta OR:</strong> Implementa la disyunciÃ³n lÃ³gica. Su salida es 1 cuando al menos una de sus entradas es 1.
                    </div>
                    
                    <div class="definition">
                        <strong>Compuerta NOT:</strong> Implementa la negaciÃ³n lÃ³gica. Su salida es el valor contrario a su entrada.
                    </div>
                    
                    <h3>2.2 DiseÃ±o de Circuitos</h3>
                    <p>Los circuitos lÃ³gicos se diseÃ±an combinando compuertas lÃ³gicas para implementar funciones booleanas.</p>
                    
                    <div class="example">
                        <strong>Ejemplo: Circuito para p â§ q</strong>
                        <p>Este circuito requiere una sola compuerta AND con dos entradas (p y q).</p>
                    </div>
                    
                    <div class="example">
                        <strong>Ejemplo: Circuito para (p â¨ q) â§ Â¬r</strong>
                        <p>Este circuito requiere:
                        <ul>
                            <li>Una compuerta OR para (p â¨ q)</li>
                            <li>Una compuerta NOT para Â¬r</li>
                            <li>Una compuerta AND para combinar los resultados</li>
                        </ul>
                        </p>
                    </div>
                    
                    <div class="important">
                        <strong>Importante:</strong> Los circuitos lÃ³gicos son la base de los sistemas digitales y se utilizan en computadoras, telÃ©fonos y todo tipo de dispositivos electrÃ³nicos.
                    </div>
                `
            },
            chapter3: {
                title: "CapÃ­tulo 3: MÃ©todos de DemostraciÃ³n",
                content: `
                    <h3>3.1 DemostraciÃ³n Directa</h3>
                    <p>En una demostraciÃ³n directa, partimos de las premisas y mediante inferencias lÃ³gicas llegamos a la conclusiÃ³n.</p>
                    
                    <div class="example">
                        <strong>Ejemplo:</strong> Demostrar que "Si n es par, entonces nÂ² es par".
                        <p>SoluciÃ³n: Si n es par, entonces n = 2k para algÃºn entero k. Entonces nÂ² = (2k)Â² = 4kÂ² = 2(2kÂ²), que es par.</p>
                    </div>
                    
                    <h3>3.2 DemostraciÃ³n por ContradicciÃ³n</h3>
                    <p>En una demostraciÃ³n por contradicciÃ³n, suponemos que la conclusiÃ³n es falsa y llegamos a una contradicciÃ³n.</p>
                    
                    <div class="example">
                        <strong>Ejemplo:</strong> Demostrar que "â2 es irracional".
                        <p>SoluciÃ³n: Supongamos que â2 es racional. Entonces â2 = a/b donde a and b son enteros coprimos. Elevando al cuadrado: 2 = aÂ²/bÂ², entonces aÂ² = 2bÂ². Esto implica que aÂ² es par, por lo que a es par. Sea a = 2c. Entonces (2c)Â² = 2bÂ², por lo que 4cÂ² = 2bÂ², entonces bÂ² = 2cÂ², por lo que bÂ² es par y b es par. Pero si a y b son pares, entonces no son coprimos, lo que contradice nuestra suposiciÃ³n. Por lo tanto, â2 es irracional.</p>
                    </div>
                    
                    <h3>3.3 DemostraciÃ³n por InducciÃ³n</h3>
                    <p>La inducciÃ³n matemÃ¡tica se utiliza para demostrar proposiciones que dependen de un parÃ¡metro natural n.</p>
                    
                    <div class="important">
                        <strong>Pasos de la inducciÃ³n matemÃ¡tica:</strong>
                        <ol>
                            <li><strong>Base inductiva:</strong> Demostrar que la proposiciÃ³n es verdadera para n = 1.</li>
                            <li><strong>HipÃ³tesis inductiva:</strong> Suponer que la proposiciÃ³n es verdadera para n = k.</li>
                            <li><strong>Paso inductivo:</strong> Demostrar que la proposiciÃ³n es verdadera para n = k + 1.</li>
                        </ol>
                    </div>
                `
            }
        };

        // Sistema de aprendizaje de la IA
        const aiLearningSystem = {
            userKnowledge: {
                basic: { score: 0, attempts: 0, correct: 0 },
                truthTable: { score: 0, attempts: 0, correct: 0 },
                circuit: { score: 0, attempts: 0, correct: 0 },
                formula: { score: 0, attempts: 0, correct: 0 }
            },
            explanationLevel: 1, // 1: BÃ¡sico, 2: Intermedio, 3: Avanzado
            userPreferences: {
                detailedExplanations: true,
                examples: true,
                visualAids: true
            },
            conversationHistory: [],
            feedbackHistory: [],
            
            // Aprender de la retroalimentaciÃ³n del usuario
            learnFromFeedback: function(messageId, wasHelpful, feedbackText = "") {
                this.feedbackHistory.push({
                    messageId,
                    wasHelpful,
                    feedbackText,
                    timestamp: new Date()
                });
                
                // Ajustar el nivel de explicaciÃ³n segÃºn la retroalimentaciÃ³n
                if (wasHelpful) {
                    this.explanationLevel = Math.min(3, this.explanationLevel + 0.1);
                    showLearningNotice("Â¡Gracias por tu feedback! Estoy mejorando mis explicaciones.");
                } else {
                    this.explanationLevel = Math.max(1, this.explanationLevel - 0.2);
                    showLearningNotice("Ajustando mis explicaciones basado en tu feedback...");
                    
                    // Si hay texto de retroalimentaciÃ³n, aprender de Ã©l
                    if (feedbackText) {
                        this.learnFromTextFeedback(feedbackText);
                    }
                }
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Aprender del texto de retroalimentaciÃ³n
            learnFromTextFeedback: function(feedbackText) {
                const lowerFeedback = feedbackText.toLowerCase();
                
                // Detectar solicitudes de mÃ¡s detalle
                if (lowerFeedback.includes("mÃ¡s detalle") || lowerFeedback.includes("explica mejor") || 
                    lowerFeedback.includes("no entiendo")) {
                    this.userPreferences.detailedExplanations = true;
                }
                
                // Detectar solicitudes de ejemplos
                if (lowerFeedback.includes("ejemplo") || lowerFeedback.includes("ejempl")) {
                    this.userPreferences.examples = true;
                }
                
                // Detectar solicitudes de ayudas visuales
                if (lowerFeedback.includes("visual") || lowerFeedback.includes("grÃ¡fico") || 
                    lowerFeedback.includes("diagrama")) {
                    this.userPreferences.visualAids = true;
                }
            },
            
            // Aprender del historial de conversaciÃ³n
            learnFromConversation: function() {
                // Analizar el historial de conversaciÃ³n para mejorar
                const lastFiveMessages = this.conversationHistory.slice(-5);
                
                // Contar preguntas del usuario
                const userQuestions = lastFiveMessages.filter(msg => msg.sender === 'user').length;
                
                // Si el usuario hace muchas preguntas, puede necesitar explicaciones mÃ¡s detalladas
                if (userQuestions >= 3) {
                    this.userPreferences.detailedExplanations = true;
                    this.explanationLevel = Math.min(3, this.explanationLevel + 0.2);
                }
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Actualizar el conocimiento del usuario
            updateUserKnowledge: function(topic, isCorrect) {
                if (!this.userKnowledge[topic]) {
                    this.userKnowledge[topic] = { score: 0, attempts: 0, correct: 0 };
                }
                
                this.userKnowledge[topic].attempts++;
                if (isCorrect) {
                    this.userKnowledge[topic].correct++;
                }
                
                this.userKnowledge[topic].score = this.userKnowledge[topic].correct / this.userKnowledge[topic].attempts;
                
                // Actualizar barra de progreso
                updateProgressBar();
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Obtener explicaciÃ³n adaptada al usuario
            getAdaptedExplanation: function(topic, baseExplanation) {
                let explanation = baseExplanation;
                
                // AÃ±adir mÃ¡s detalle si es necesario
                if (this.userPreferences.detailedExplanations) {
                    explanation += this.getAdditionalDetails(topic);
                }
                
                // AÃ±adir ejemplos si es necesario
                if (this.userPreferences.examples) {
                    explanation += this.getExample(topic);
                }
                
                // Ajustar segÃºn el nivel de explicaciÃ³n
                if (this.explanationLevel < 2) {
                    // ExplicaciÃ³n mÃ¡s simple
                    explanation = explanation.replace(/tÃ©rminos tÃ©cnicos/g, "conceptos")
                                             .replace(/En lÃ³gica proposicional/g, "En este tema");
                } else if (this.explanationLevel > 2) {
                    // ExplicaciÃ³n mÃ¡s avanzada
                    explanation += this.getAdvancedInsight(topic);
                }
                
                return explanation;
            },
            
            // Obtener detalles adicionales segÃºn el tema
            getAdditionalDetails: function(topic) {
                const details = {
                    basic: "\n\nRecuerda que en lÃ³gica proposicional trabajamos con valores de verdad binarios: verdadero (1) y falso (0).",
                    truthTable: "\n\nCada variable proposicional tiene dos valores posibles, por lo que para n variables necesitarÃ¡s 2^n filas en tu tabla de verdad.",
                    circuit: "\n\nLas compuertas lÃ³gicas se pueden combinar de muchas formas para crear circuitos mÃ¡s complejos que representen expresiones lÃ³gicas.",
                    formula: "\n\nAl analizar fÃ³rmulas complejas, es Ãºtil descomponerlas en partes mÃ¡s pequeÃ±as y evaluar cada componente por separado."
                };
                
                return details[topic] || "";
            },
            
            // Obtener ejemplos segÃºn el tema
            getExample: function(topic) {
                const examples = {
                    basic: "\n\nPor ejemplo, si p es verdadero y q es falso, entonces p â§ q es falso, pero p â¨ q es verdadero.",
                    truthTable: "\n\nPor ejemplo, para una expresiÃ³n con 2 variables, la tabla de verdad tendrÃ¡ 4 filas que representan todas las combinaciones posibles.",
                    circuit: "\n\nPor ejemplo, la expresiÃ³n p â§ q se representarÃ­a con una compuerta AND que toma las entradas p y q.",
                    formula: "\n\nPor ejemplo, la fÃ³rmula Â¬(p â¨ q) es equivalente a Â¬p â§ Â¬q segÃºn las leyes de De Morgan."
                };
                
                return examples[topic] || "";
            },
            
            // Obtener informaciÃ³n avanzada segÃºn el tema
            getAdvancedInsight: function(topic) {
                const insights = {
                    basic: "\n\nDesde una perspectiva mÃ¡s avanzada, puedes notar que el operador condicional (â) no es conmutativo, a diferencia de la conjunciÃ³n y disyunciÃ³n.",
                    truthTable: "\n\nUna perspectiva avanzada: las tablas de verdad son la base para la implementaciÃ³n de circuitos digitales y Ã¡lgebra booleana.",
                    circuit: "\n\nPerspectiva avanzada: estos circuitos lÃ³gicos son la base de los procesadores modernos y se implementan fÃ­sicamente con transistores.",
                    formula: "\n\nPerspectiva avanzada: el anÃ¡lisis de fÃ³rmulas lÃ³gicas es fundamental en ciencias de la computaciÃ³n, especialmente en verificaciÃ³n formal y diseÃ±o de algoritmos."
                };
                
                return insights[topic] || "";
            },
            
            // Guardar en localStorage
            saveToLocalStorage: function() {
                const data = {
                    userKnowledge: this.userKnowledge,
                    explanationLevel: this.explanationLevel,
                    userPreferences: this.userPreferences,
                    feedbackHistory: this.feedbackHistory
                };
                
                localStorage.setItem('aiLearningData', JSON.stringify(data));
            },
            
            // Cargar desde localStorage
            loadFromLocalStorage: function() {
                const data = JSON.parse(localStorage.getItem('aiLearningData'));
                if (data) {
                    this.userKnowledge = data.userKnowledge || this.userKnowledge;
                    this.explanationLevel = data.explanationLevel || this.explanationLevel;
                    this.userPreferences = data.userPreferences || this.userPreferences;
                    this.feedbackHistory = data.feedbackHistory || this.feedbackHistory;
                    
                    // Actualizar barra de progreso
                    updateProgressBar();
                }
            }
        };

        let currentExerciseType = 'basic';
        let currentExerciseIndex = 0;
        let messageCounter = 0;
        
        // Variables para el mÃ³dulo de lectura
        let currentChapter = 1;
        let explanationLevel = 'normal';

        // Respuestas predefinidas del asistente IA mejorado
        const aiResponses = {
            "hola": "Â¡Hola! Soy tu asistente avanzado de lÃ³gica proposicional. Puedo analizar tus respuestas escritas, explicarte conceptos y ayudarte a resolver problemas. Â¿En quÃ© necesitas ayuda?",
            "ayuda": "Puedo ayudarte con: valores de verdad, tablas de verdad, circuitos lÃ³gicos, equivalencias lÃ³gicas y mÃ¡s. TambiÃ©n puedo analizar tus respuestas escritas y proporcionarte retroalimentaciÃ³n detallada.",
            "verdad": "El valor de verdad de una proposiciÃ³n es su cualidad de ser verdadera (1) o falsa (0). En lÃ³gica proposicional, trabajamos con estos dos valores.",
            "conjuncion": "La conjunciÃ³n (p â§ q) es verdadera solo cuando ambas proposiciones son verdaderas. Su tabla de verdad es: p=1, q=1 â 1; p=1, q=0 â 0; p=0, q=1 â 0; p=0, q=0 â 0.",
            "disyuncion": "La disyunciÃ³n (p â¨ q) es falsa solo cuando ambas proposiciones son falsas. Su tabla de verdad es: p=1, q=1 â 1; p=1, q=0 â 1; p=0, q=1 â 1; p=0, q=0 â 0.",
            "condicional": "El condicional (p â q) es falso solo cuando p es verdadera y q es falsa. Su tabla de verdad es: p=1, q=1 â 1; p=1, q=0 â 0; p=0, q=1 â 1; p=0, q=0 â 1.",
            "tabla": "Una tabla de verdad muestra todos los posibles valores de verdad de una proposiciÃ³n compuesta. Para n variables, hay 2^n combinaciones posibles.",
            "circuito": "Los circuitos lÃ³gicos representan proposiciones usando compuertas AND, OR y NOT. Cada compuerta corresponde a un operador lÃ³gico especÃ­fico.",
            "formula": "Puedo analizar fÃ³rmulas lÃ³gicas que me proporciones. Usa los sÃ­mbolos: Â¬ (negaciÃ³n), â§ (conjunciÃ³n), â¨ (disyunciÃ³n), â (condicional), â (bicondicional).",
            "default": "No estoy seguro de entender completamente. Â¿PodrÃ­as reformular tu pregunta o ser mÃ¡s especÃ­fico? Estoy aquÃ­ para ayudarte con conceptos de lÃ³gica proposicional."
        };

        // Funciones para el mÃ³dulo de lectura
        function openReadingModal() {
            document.getElementById('readingModal').style.display = 'flex';
            loadChapter(currentChapter);
        }

        function closeReadingModal() {
            document.getElementById('readingModal').style.display = 'none';
        }

        function loadChapter(chapterNumber) {
            const chapterKey = `chapter${chapterNumber}`;
            if (bookContent[chapterKey]) {
                document.getElementById('bookContent').innerHTML = bookContent[chapterKey].content;
                document.getElementById('currentChapter').textContent = bookContent[chapterKey].title;
                
                // Actualizar botones de navegaciÃ³n
                document.getElementById('prevChapter').disabled = chapterNumber === 1;
                document.getElementById('nextChapter').disabled = chapterNumber === 3;
                
                // Mostrar explicaciÃ³n inicial
                updateExplanation();
            }
        }

        function changeChapter(direction) {
            currentChapter += direction;
            loadChapter(currentChapter);
        }

        function changeExplanationLevel(level) {
            explanationLevel = level;
            
            // Actualizar botones
            document.getElementById('btnBasic').classList.toggle('active', level === 'basic');
            document.getElementById('btnNormal').classList.toggle('active', level === 'normal');
            document.getElementById('btnAdvanced').classList.toggle('active', level === 'advanced');
            
            // Actualizar explicaciÃ³n
            updateExplanation();
        }

        function updateExplanation() {
            let explanation = "";
            
            switch(currentChapter) {
                case 1:
                    if (explanationLevel === 'basic') {
                        explanation = "En este capÃ­tulo aprenderÃ¡s quÃ© es una proposiciÃ³n y cÃ³mo se combinan usando conectivos lÃ³gicos. Es como aprender las palabras y reglas gramaticales bÃ¡sicas de un nuevo idioma.";
                    } else if (explanationLevel === 'normal') {
                        explanation = "La lÃ³gica proposicional es la base de todo razonamiento matemÃ¡tico. AquÃ­ aprenderÃ¡s a identificar proposiciones, entender conectivos lÃ³gicos y construir tablas de verdad. Presta especial atenciÃ³n a cÃ³mo funciona el condicional (â), ya que suele causar confusiÃ³n.";
                    } else {
                        explanation = "Este capÃ­tulo sienta las bases para el razonamiento formal. MÃ¡s allÃ¡ de los conceptos bÃ¡sicos, reflexiona sobre cÃ³mo estos principios se aplican en programaciÃ³n, electrÃ³nica y matemÃ¡ticas avanzadas. Las tablas de verdad son el primer paso hacia el Ã¡lgebra booleana, fundamental en ciencias de la computaciÃ³n.";
                    }
                    break;
                case 2:
                    if (explanationLevel === 'basic') {
                        explanation = "Los circuitos lÃ³gicos son la forma prÃ¡ctica de aplicar la lÃ³gica proposicional. Las compuertas AND, OR y NOT son como piezas de Lego que puedes combinar para construir circuitos mÃ¡s complejos.";
                    } else if (explanationLevel === 'normal') {
                        explanation = "Este capÃ­tulo conecta la teorÃ­a con aplicaciones prÃ¡cticas. Cada compuerta lÃ³gica corresponde directamente a un operador lÃ³gico. Al diseÃ±ar circuitos, estÃ¡s implementando fÃ­sicamente las expresiones lÃ³gicas que aprendiste en el capÃ­tulo anterior.";
                    } else {
                        explanation = "Los circuitos lÃ³gicos son la base de todos los sistemas digitales modernos. Profundizando, puedes explorar cÃ³mo se minimizan circuitos usando Ã¡lgebra booleana, o cÃ³mo se implementan fÃ­sicamente con transistores. Este conocimiento es esencial en ingenierÃ­a electrÃ³nica y arquitectura de computadoras.";
                    }
                    break;
                case 3:
                    if (explanationLevel === 'basic') {
                        explanation = "Las demostraciones matemÃ¡ticas son como puzzles lÃ³gicos. AquÃ­ aprenderÃ¡s diferentes mÃ©todos para demostrar que algo es verdadero, usando lo que aprendiste sobre lÃ³gica en los capÃ­tulos anteriores.";
                    } else if (explanationLevel === 'normal') {
                        explanation = "Este capÃ­tulo te enseÃ±a a estructurar argumentos lÃ³gicos de manera rigurosa. Cada mÃ©todo de demostraciÃ³n tiene su lugar: la directa para casos simples, la contradicciÃ³n para resultados de negaciÃ³n, y la inducciÃ³n para propiedades que dependen de nÃºmeros naturales.";
                    } else {
                        explanation = "Las tÃ©cnicas de demostraciÃ³n son el corazÃ³n del quehacer matemÃ¡tico profesional. MÃ¡s allÃ¡ de estos mÃ©todos bÃ¡sicos, existen variantes como la inducciÃ³n fuerte o la demostraciÃ³n por casos. Dominar estas tÃ©cnicas te prepararÃ¡ para matemÃ¡ticas avanzadas y investigaciÃ³n.";
                    }
                    break;
            }
            
            document.getElementById('iaExplanation').textContent = explanation;
        }

        function askQuestion(type) {
            let question = "";
            let answer = "";
            
            switch(type) {
                case 'explicame este concepto':
                    if (currentChapter === 1) {
                        question = "ExplicaciÃ³n de proposiciones y conectivos lÃ³gicos";
                        answer = "Imagina que las proposiciones son bloques de construcciÃ³n y los conectivos lÃ³gicos son las formas de unirlos. Por ejemplo, la conjunciÃ³n (AND) es como decir 'ambos deben ser verdaderos', mientras que la disyunciÃ³n (OR) es como decir 'al menos uno debe ser verdadero'. El condicional (â) es mÃ¡s subtle: p â q solo es falsa cuando p es verdadera pero q es falsa. Es como una promesa: 'Si estudias, entonces aprobarÃ¡s' solo se rompe si estudias pero no apruebas.";
                    } else if (currentChapter === 2) {
                        question = "ExplicaciÃ³n de compuertas lÃ³gicas";
                        answer = "Las compuertas lÃ³gicas son como interruptores inteligentes. La compuerta AND enciende solo cuando todas sus entradas estÃ¡n activadas. La OR se enciende cuando al menos una entrada estÃ¡ activada. La NOT simplemente invierte: si la entrada es 1, la salida es 0, y viceversa. Juntas, pueden crear circuitos complejos como los que hay dentro de tu telÃ©fono o computadora.";
                    } else {
                        question = "ExplicaciÃ³n de mÃ©todos de demostraciÃ³n";
                        answer = "Cada mÃ©todo de demostraciÃ³n es una estrategia diferente para convencer de que algo es verdadero. La demostraciÃ³n directa es como seguir un camino paso a paso. La contradicciÃ³n es como decir 'si esto fuera falso, llegarÃ­a a un absurdo'. La inducciÃ³n es como una fila de fichas de dominÃ³: si la primera cae (caso base) y cada ficha hace caer a la siguiente (paso inductivo), entonces todas caerÃ¡n.";
                    }
                    break;
                case 'ejemplo de este tema':
                    if (currentChapter === 1) {
                        question = "Ejemplo de lÃ³gica proposicional";
                        answer = "Supongamos que p: 'EstÃ¡ lloviendo' y q: 'Tengo paraguas'. Entonces:\n- p â§ q: 'EstÃ¡ lloviendo y tengo paraguas' â Solo verdadero si ambas son ciertas\n- p â¨ q: 'EstÃ¡ lloviendo o tengo paraguas' â Falso solo si no llueve y no tengo paraguas\n- p â q: 'Si estÃ¡ lloviendo, entonces tengo paraguas' â Falso solo si llueve pero no tengo paraguas";
                    } else if (currentChapter === 2) {
                        question = "Ejemplo de circuito lÃ³gico";
                        answer = "Para la expresiÃ³n (p â§ q) â¨ r:\n1. Necesitas una compuerta AND para p â§ q\n2. Esta salida se conecta a una compuerta OR junto con r\n3. El resultado final es 1 cuando: (p y q son 1) O (r es 1)\nEste circuito podrÃ­a representar un sistema de alarma que se activa cuando (hay humo Y hay calor) O cuando alguien presiona manualmente el botÃ³n de emergencia.";
                    } else {
                        question = "Ejemplo de demostraciÃ³n";
                        answer = "Teorema: La suma de dos nÃºmeros pares es par.\nDemostraciÃ³n directa:\n1. Sean a y b nÃºmeros pares, entonces a = 2m, b = 2n para algunos enteros m, n\n2. a + b = 2m + 2n = 2(m + n)\n3. Como m + n es entero, a + b es mÃºltiplo de 2, es decir, par.\nQED";
                    }
                    break;
                case 'ejercicio relacionado':
                    if (currentChapter === 1) {
                        question = "Ejercicio de lÃ³gica proposicional";
                        answer = "Ejercicio: Si p es verdadera, q es falsa y r es verdadera, determina el valor de:\n(Â¬p â¨ q) â (q â§ r)\n\nSugerencia: Primero encuentra los valores de Â¬p, Â¬p â¨ q, y q â§ r. Luego aplica la tabla de verdad del condicional.";
                    } else if (currentChapter === 2) {
                        question = "Ejercicio de circuitos lÃ³gicos";
                        answer = "Ejercicio: DiseÃ±a un circuito lÃ³gico para la expresiÃ³n Â¬(p â¨ q) â§ r\n\nSugerencia: NecesitarÃ¡s una compuerta OR para p â¨ q, una NOT para negar ese resultado, y una AND para combinar con r.";
                    } else {
                        question = "Ejercicio de demostraciÃ³n";
                        answer = "Ejercicio: Demuestra por contradicciÃ³n que no existe el mayor nÃºmero primo.\n\nSugerencia: SupÃ³n que existe un nÃºmero primo mayor que todos. Considera el producto de todos los primos mÃ¡s 1. Â¿QuÃ© propiedades tiene este nÃºmero?";
                    }
                    break;
                case 'aplicaciÃ³n prÃ¡ctica':
                    if (currentChapter === 1) {
                        question = "AplicaciÃ³n de lÃ³gica proposicional";
                        answer = "La lÃ³gica proposicional se usa en:\n- ProgramaciÃ³n: Condiciones en sentencias if, bucles\n- Bases de datos: Consultas con operadores AND, OR, NOT\n- Derecho: AnÃ¡lisis de contratos y regulaciones\n- ElectrÃ³nica: DiseÃ±o de circuitos digitales\n- Inteligencia artificial: Sistemas expertos y razonamiento automatizado";
                    } else if (currentChapter === 2) {
                        question = "AplicaciÃ³n de circuitos lÃ³gicos";
                        answer = "Los circuitos lÃ³gicos son la base de:\n- Procesadores de computadoras: CPUs estÃ¡n compuestas de millones de compuertas\n- Memorias: Celdas de memoria usan circuitos flip-flop\n- Sistemas de control: Desde semÃ¡foros hasta naves espaciales\n- Dispositivos cotidianos: Calculadoras, relojes digitales, controles remotos";
                    } else {
                        question = "AplicaciÃ³n de mÃ©todos de demostraciÃ³n";
                        answer = "Las tÃ©cnicas de demostraciÃ³n son esenciales en:\n- MatemÃ¡ticas puras: Para establecer verdades con certeza absoluta\n- Ciencias de la computaciÃ³n: VerificaciÃ³n formal de algoritmos\n- IngenierÃ­a: Demostrar que un diseÃ±o cumple especificaciones\n- CriptografÃ­a: Probar la seguridad de protocolos\n- FilosofÃ­a: AnÃ¡lisis de argumentos y falacias";
                    }
                    break;
            }
            
            document.getElementById('iaExplanation').textContent = answer;
        }

        // FunciÃ³n para mostrar notificaciÃ³n de aprendizaje
        function showLearningNotice(message) {
            const notice = document.getElementById('learningNotice');
            notice.textContent = message;
            notice.classList.add('show');
            
            setTimeout(() => {
                notice.classList.remove('show');
            }, 3000);
        }

        // FunciÃ³n para actualizar la barra de progreso
        function updateProgressBar() {
            const knowledge = aiLearningSystem.userKnowledge;
            let totalScore = 0;
            let totalTopics = 0;
            
            for (const topic in knowledge) {
                if (knowledge[topic].attempts > 0) {
                    totalScore += knowledge[topic].score;
                    totalTopics++;
                }
            }
            
            const overallProgress = totalTopics > 0 ? (totalScore / totalTopics) * 100 : 0;
            
            document.getElementById('progressValue').style.width = `${overallProgress}%`;
            document.getElementById('progressPercent').textContent = `${Math.round(overallProgress)}%`;
        }

        // FunciÃ³n para cambiar el tipo de ejercicio
        function changeExerciseType(type) {
            currentExerciseType = type;
            currentExerciseIndex = 0;
            
            // Actualizar botones activos
            document.querySelectorAll('.exercise-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Mostrar/ocultar Ã¡reas segÃºn el tipo
            if (type === 'formula') {
                document.getElementById('formula-input-container').style.display = 'block';
                document.querySelector('.input-area').style.display = 'none';
                document.querySelector('.exercise').style.display = 'none';
            } else {
                document.getElementById('formula-input-container').style.display = 'none';
                document.querySelector('.input-area').style.display = 'flex';
                document.querySelector('.exercise').style.display = 'block';
                
                // Cargar nuevo ejercicio
                loadExercise();
            }
            
            addMessage(`He cambiado a ejercicios de ${getExerciseTypeName(type)}. Â¿Necesitas ayuda con este tipo de problemas?`, "ai");
        }
        
        function getExerciseTypeName(type) {
            const names = {
                'basic': 'lÃ³gica bÃ¡sica',
                'truth-table': 'tablas de verdad',
                'circuit': 'circuitos lÃ³gicos',
                'formula': 'resoluciÃ³n de fÃ³rmulas'
            };
            return names[type] || type;
        }
        
        // FunciÃ³n para cargar el ejercicio actual
        function loadExercise() {
            if (currentExerciseType === 'formula') {
                return; // No cargar ejercicio predefinido para el tipo fÃ³rmula
            }
            
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            document.querySelector('.exercise-content').textContent = exercise.content;
            document.querySelector('.exercise-difficulty').textContent = `(${getExerciseTypeName(currentExerciseType)})`;
            
            // Limpiar feedback
            document.getElementById('feedbackSection').innerHTML = `
                <h3><i class="fas fa-comment-dots"></i> RetroalimentaciÃ³n</h3>
                <p>AquÃ­ verÃ¡s el anÃ¡lisis de tu respuesta y correcciones si es necesario.</p>
            `;
            
            // Limpiar Ã¡rea de texto
            document.getElementById('userSolution').value = '';
        }

        // FunciÃ³n mejorada para verificar la soluciÃ³n con IA avanzada
        function checkSolution() {
            const userSolution = document.getElementById('userSolution').value;
            const feedbackSection = document.getElementById('feedbackSection');
            
            if (!userSolution.trim()) {
                feedbackSection.innerHTML = `
                    <h3><i class="fas fa-exclamation-triangle"></i> RetroalimentaciÃ³n</h3>
                    <p>Por favor, escribe tu soluciÃ³n antes de verificar.</p>
                `;
                return;
            }
            
            // Mostrar indicador de typing
            showTypingIndicator();
            
            // Simular procesamiento con IA
            setTimeout(() => {
                // AnÃ¡lisis avanzado de la respuesta (simulaciÃ³n de IA mejorada)
                const exercise = exercises[currentExerciseType][currentExerciseIndex];
                let feedbackHTML = `
                    <h3><i class="fas fa-comment-dots"></i> AnÃ¡lisis Detallado de tu Respuesta</h3>
                `;
                
                // AnÃ¡lisis basado en el tipo de ejercicio
                if (currentExerciseType === 'basic') {
                    feedbackHTML += analyzeBasicSolution(userSolution, exercise);
                    // Actualizar conocimiento del usuario
                    aiLearningSystem.updateUserKnowledge('basic', true);
                } else if (currentExerciseType === 'truth-table') {
                    feedbackHTML += analyzeTruthTableSolution(userSolution, exercise);
                    aiLearningSystem.updateUserKnowledge('truthTable', true);
                } else if (currentExerciseType === 'circuit') {
                    feedbackHTML += analyzeCircuitSolution(userSolution, exercise);
                    aiLearningSystem.updateUserKnowledge('circuit', true);
                }
                
                feedbackSection.innerHTML = feedbackHTML;
                
                // AÃ±adir mensaje del asistente
                addMessage("He analizado tu soluciÃ³n en detalle. Â¿Hay algÃºn concepto especÃ­fico que te gustarÃ­a que explique mÃ¡s a fondo?", "ai");
                
                // Aprender de la conversaciÃ³n
                aiLearningSystem.learnFromConversation();
            }, 2000);
        }

        // FunciÃ³n para analizar soluciones de lÃ³gica bÃ¡sica
        function analyzeBasicSolution(userSolution, exercise) {
            let analysis = '';
            const lowerSolution = userSolution.toLowerCase();
            
            // Detectar valores de verdad correctos
            if (lowerSolution.includes("verdadero") || lowerSolution.includes("1") || lowerSolution.includes("true")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado valores verdaderos adecuadamente.</p>`;
            }
            
            if (lowerSolution.includes("falso") || lowerSolution.includes("0") || lowerSolution.includes("false")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado valores falsos adecuadamente.</p>`;
            }
            
            // Detectar operadores lÃ³gicos
            if (lowerSolution.includes("â§") || lowerSolution.includes("y") || lowerSolution.includes("conjunciÃ³n")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido la conjunciÃ³n (â§).</p>`;
            }
            
            if (lowerSolution.includes("â¨") || lowerSolution.includes("o") || lowerSolution.includes("disyunciÃ³n")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido la disyunciÃ³n (â¨).</p>`;
            }
            
            if (lowerSolution.includes("â") || lowerSolution.includes("entonces") || lowerSolution.includes("condicional")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido el condicional (â).</p>`;
            }
            
            // Detectar posibles errores
            if (!lowerSolution.includes("falso") && !lowerSolution.includes("0") && !lowerSolution.includes("false")) {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: No parece que hayas identificado valores falsos. Recuerda que p â§ q es falso cuando al menos una proposiciÃ³n es falsa.</p>`;
            }
            
            if ((lowerSolution.includes("verdadero") || lowerSolution.includes("1")) && 
                !lowerSolution.includes("falso") && !lowerSolution.includes("0")) {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Parece que solo has identificado valores verdaderos. Recuerda que en lÃ³gica proposicional hay dos valores posibles: verdadero y falso.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Siempre verifica ambos valores de verdad (verdadero y falso) para cada operaciÃ³n lÃ³gica.</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi anÃ¡lisis detectÃ³ que comprendes los conceptos bÃ¡sicos, pero debes prestar atenciÃ³n a los casos donde las proposiciones son falsas.</p>
            `;
            
            return analysis;
        }

        // FunciÃ³n para analizar soluciones de tablas de verdad
        function analyzeTruthTableSolution(userSolution, exercise) {
            let analysis = `
                <p><i class="fas fa-check-circle" style="color: var(--success);"></i> He detectado que estÃ¡s trabajando con tablas de verdad.</p>
            `;
            
            if (userSolution.includes("combinaciÃ³n") || userSolution.includes("combinaciones")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has considerado las combinaciones de valores de verdad.</p>`;
            } else {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Para tablas de verdad, es importante considerar todas las combinaciones posibles de valores de verdad.</p>`;
            }
            
            if (userSolution.includes("variable") || userSolution.includes("variables")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado las variables proposicionales.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Para n variables, una tabla de verdad tiene 2^n filas. AsegÃºrate de incluir todas las combinaciones posibles.</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi anÃ¡lisis sugiere que comprendes la estructura de las tablas de verdad, pero debes verificar que hayas incluido todas las combinaciones posibles.</p>
            `;
            
            return analysis;
        }

        // FunciÃ³n para analizar soluciones de circuitos lÃ³gicos
        function analyzeCircuitSolution(userSolution, exercise) {
            let analysis = `
                <p><i class="fas fa-check-circle" style="color: var(--success);"></i> He detectado que estÃ¡s trabajando con circuitos lÃ³gicos.</p>
            `;
            
            if (userSolution.includes("compuerta") || userSolution.includes("compuertas")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado las compuertas lÃ³gicas.</p>`;
            } else {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Para circuitos lÃ³gicos, es importante identificar las compuertas (AND, OR, NOT) correspondientes.</p>`;
            }
            
            if (userSolution.includes("AND") || userSolution.includes("OR") || userSolution.includes("NOT")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido los tipos de compuertas lÃ³gicas.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Recuerda que AND representa la conjunciÃ³n (â§), OR la disyunciÃ³n (â¨) y NOT la negaciÃ³n (Â¬).</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi anÃ¡lisis indica que comprendes la relaciÃ³n entre operadores lÃ³gicos y compuertas, pero asegÃºrate de verificar todas las conexiones en tu circuito.</p>
            `;
            
            return analysis;
        }

        // FunciÃ³n para mostrar la soluciÃ³n completa
        function showSolution() {
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            addMessage("Claro, aquÃ­ estÃ¡ la soluciÃ³n paso a paso para el ejercicio actual:", "ai");
            
            // Mostrar indicador de typing
            showTypingIndicator();
            
            // Mostrar pasos de soluciÃ³n despuÃ©s de un breve delay
            setTimeout(() => {
                exercise.solution.steps.forEach((step, index) => {
                    setTimeout(() => {
                        addMessage(step, "ai");
                        
                        // Preguntar si necesita ayuda despuÃ©s del Ãºltimo paso
                        if (index === exercise.solution.steps.length - 1) {
                            setTimeout(() => {
                                addMessage("Â¿Te quedÃ³ claro? Â¿Necesitas que explique algÃºn paso en detalle?", "ai");
                            }, 500);
                        }
                    }, (index + 1) * 800);
                });
            }, 1000);
        }

        // FunciÃ³n para generar un nuevo ejercicio
        function newExercise() {
            // Avanzar al siguiente ejercicio (circular)
            currentExerciseIndex = (currentExerciseIndex + 1) % exercises[currentExerciseType].length;
            loadExercise();
            
            addMessage(`He generado un nuevo ejercicio de ${getExerciseTypeName(currentExerciseType)}. Â¿Necesitas ayuda para resolverlo?`, "ai");
        }

        // FunciÃ³n para proporcionar una explicaciÃ³n adaptativa
        function adaptiveExplanation() {
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            let explanation = "";
            
            // Obtener explicaciÃ³n base segÃºn el tipo de ejercicio
            if (currentExerciseType === 'basic') {
                explanation = "Para resolver este ejercicio de lÃ³gica bÃ¡sica, debes seguir estos pasos:";
            } else if (currentExerciseType === 'truth-table') {
                explanation = "Para construir una tabla de verdad, sigue estos pasos:";
            } else if (currentExerciseType === 'circuit') {
                explanation = "Para diseÃ±ar un circuito lÃ³gico, considera estos pasos:";
            }
            
            // Obtener explicaciÃ³n adaptada
            explanation = aiLearningSystem.getAdaptedExplanation(currentExerciseType, explanation);
            
            // AÃ±adir los pasos de la soluciÃ³n
            explanation += "\n\n" + exercise.solution.steps.join('\n');
            
            addMessage(explanation, "ai");
        }

        // FunciÃ³n para limpiar todo
        function clearAll() {
            document.getElementById('userSolution').value = '';
            document.getElementById('feedbackSection').innerHTML = `
                <h3><i class="fas fa-comment-dots"></i> RetroalimentaciÃ³n</h3>
                <p>AquÃ­ verÃ¡s el anÃ¡lisis de tu respuesta y correcciones si es necesario.</p>
            `;
            
            addMessage("He limpiado tu Ã¡rea de trabajo. Â¿En quÃ© puedo ayudarte ahora?", "ai");
        }

        // FunciÃ³n para mostrar indicador de typing
        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingIndicator = document.createElement('div');
            typingIndicator.classList.add('typing-indicator');
            typingIndicator.id = 'typingIndicator';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.classList.add('typing-dot');
                typingIndicator.appendChild(dot);
            }
            
            chatContainer.appendChild(typingIndicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // FunciÃ³n para ocultar indicador de typing
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // FunciÃ³n para manejar la subida de imÃ¡genes
        function handleImageUpload(files) {
            if (files.length > 0) {
                const file = files[0];
                const reader = new FileReader();
                
                // Mostrar vista previa de la imagen
                reader.onload = function(e) {
                    const preview = document.getElementById('imagePreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    
                    // Mostrar barra de progreso
                    const progressBar = document.getElementById('progressBar');
                    const progressFill = document.getElementById('progressFill');
                    progressBar.style.display = 'block';
                    
                    // Simular anÃ¡lisis progresivo
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 5;
                        progressFill.style.width = `${progress}%`;
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            simulateImageAnalysis(file);
                        }
                    }, 100);
                };
                
                reader.readAsDataURL(file);
            }
        }

        // FunciÃ³n para simular el anÃ¡lisis de imagen
        function simulateImageAnalysis(file) {
            addMessage("He recibido tu imagen. Estoy analizando el problema...", "ai");
            
            // Ocultar barra de progreso
            setTimeout(() => {
                document.getElementById('progressBar').style.display = 'none';
                
                // Simular diferentes tipos de anÃ¡lisis basados en el nombre del archivo
                const fileName = file.name.toLowerCase();
                
                if (fileName.includes("tabla") || fileName.includes("verdad")) {
                    addMessage("He detectado una tabla de verdad en tu imagen. DÃ©jame analizarla...", "ai");
                    setTimeout(() => {
                        addMessage("La tabla de verdad corresponde a la expresiÃ³n: (p â¨ q) â§ Â¬p", "ai");
                        addMessage("Â¿Te gustarÃ­a que te muestre cÃ³mo construir esta tabla paso a paso?", "ai");
                        
                        // Cambiar a ejercicios de tabla de verdad
                        changeExerciseType('truth-table');
                    }, 2000);
                } else if (fileName.includes("circuito") || fileName.includes("compuerta")) {
                    addMessage("Veo que has subido un diagrama de circuito lÃ³gico. Analizando...", "ai");
                    setTimeout(() => {
                        addMessage("El circuito corresponde a la expresiÃ³n: (p â§ q) â¨ (Â¬p â§ r)", "ai");
                        addMessage("Â¿Quieres que te explique cÃ³mo funciona este circuito?", "ai");
                        
                        // Cambiar a ejercicios de circuitos
                        changeExerciseType('circuit');
                    }, 2000);
                } else {
                    addMessage("He detectado un ejercicio de lÃ³gica proposicional en tu imagen.", "ai");
                    setTimeout(() => {
                        addMessage("Parece ser un problema que involucra valores de verdad y operaciones lÃ³gicas.", "ai");
                        addMessage("Â¿Te gustarÃ­a que te guÃ­e en la soluciÃ³n?", "ai");
                        
                        // Cambiar a ejercicios bÃ¡sicos
                        changeExerciseType('basic');
                    }, 2000);
                }
            }, 1500);
        }

        // FunciÃ³n para enviar mensaje al asistente
        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (message) {
                addMessage(message, "user");
                userInput.value = '';
                
                // Mostrar indicador de typing
                showTypingIndicator();
                
                // Simularæèè¿ç¨
                setTimeout(() => {
                    hideTypingIndicator();
                    
                    // Buscar respuesta predefinida o usar default
                    const lowerMessage = message.toLowerCase();
                    let response = aiResponses.default;
                    
                    for (const [key, value] of Object.entries(aiResponses)) {
                        if (lowerMessage.includes(key)) {
                            response = value;
                            break;
                        }
                    }
                    
                    // Adaptar la respuesta segÃºn el sistema de aprendizaje
                    response = aiLearningSystem.getAdaptedExplanation(currentExerciseType, response);
                    
                    addMessage(response, "ai");
                    
                    // Aprender de la conversaciÃ³n
                    aiLearningSystem.learnFromConversation();
                }, 1500);
            }
        }
        
        // FunciÃ³n para enviar una sugerencia predefinida
        function sendSuggestion(suggestion) {
            document.getElementById('userInput').value = suggestion;
            sendMessage();
        }
        
        // FunciÃ³n para manejar la tecla Enter en el chat
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // FunciÃ³n para aÃ±adir mensaje al chat con sistema de retroalimentaciÃ³n
        function addMessage(text, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(sender === 'ai' ? 'ai-message' : 'user-message');
            
            // AÃ±adir ID Ãºnico al mensaje para retroalimentaciÃ³n
            const messageId = `msg-${messageCounter++}`;
            messageElement.id = messageId;
            
            messageElement.textContent = text;
            
            // AÃ±adir botones de retroalimentaciÃ³n para mensajes de IA
            if (sender === 'ai') {
                const feedbackButtons = document.createElement('div');
                feedbackButtons.classList.add('feedback-buttons');
                
                const helpfulBtn = document.createElement('button');
                helpfulBtn.classList.add('feedback-btn', 'helpful');
                helpfulBtn.innerHTML = '<i class="fas fa-thumbs-up"></i> Ãtil';
                helpfulBtn.onclick = function() {
                    aiLearningSystem.learnFromFeedback(messageId, true);
                    this.disabled = true;
                    notHelpfulBtn.disabled = true;
                };
                
                const notHelpfulBtn = document.createElement('button');
                notHelpfulBtn.classList.add('feedback-btn', 'not-helpful');
                notHelpfulBtn.innerHTML = '<i class="fas fa-thumbs-down"></i> No Ãºtil';
                notHelpfulBtn.onclick = function() {
                    const feedbackText = prompt("Â¿CÃ³mo podrÃ­a mejorar mi explicaciÃ³n?");
                    aiLearningSystem.learnFromFeedback(messageId, false, feedbackText);
                    this.disabled = true;
                    helpfulBtn.disabled = true;
                };
                
                feedbackButtons.appendChild(helpfulBtn);
                feedbackButtons.appendChild(notHelpfulBtn);
                
                messageElement.appendChild(feedbackButtons);
            }
            
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Guardar en historial de conversaciÃ³n
            aiLearningSystem.conversationHistory.push({
                id: messageId,
                text: text,
                sender: sender,
                timestamp: new Date()
            });
        }

        // NUEVAS FUNCIONES PARA EL ANALIZADOR DE FÃRMULAS
        
        // FunciÃ³n para insertar sÃ­mbolos en el input de fÃ³rmula
        function insertSymbol(symbol) {
            const formulaInput = document.getElementById('formulaInput');
            const startPos = formulaInput.selectionStart;
            const endPos = formulaInput.selectionEnd;
            
            formulaInput.value = formulaInput.value.substring(0, startPos) + 
                                symbol + 
                                formulaInput.value.substring(endPos);
            
            // Colocar el cursor despuÃ©s del sÃ­mbolo insertado
            formulaInput.selectionStart = formulaInput.selectionEnd = startPos + symbol.length;
            formulaInput.focus();
        }
        
        // FunciÃ³n para establecer un ejemplo de fÃ³rmula
        function setFormulaExample(formula) {
            document.getElementById('formulaInput').value = formula;
            document.getElementById('formulaInput').focus();
        }
        
        // FunciÃ³n para analizar la fÃ³rmula ingresada
        function analyzeFormula() {
            const formula = document.getElementById('formulaInput').value.trim();
            
            if (!formula) {
                alert('Por favor, ingresa una fÃ³rmula lÃ³gica');
                return;
            }
            
            // Mostrar indicador de typing
            showTypingIndicator();
            
            // Simular procesamiento
            setTimeout(() => {
                hideTypingIndicator();
                
                // Analizar la fÃ³rmula
                const result = parseFormula(formula);
                
                // Mostrar resultados
                displayFormulaResult(result, formula);
                
                // AÃ±adir mensaje al chat
                addMessage(`He analizado la fÃ³rmula: ${formula}. Â¿Necesitas que explique algÃºn paso en detalle?`, "ai");
                
                // Actualizar conocimiento del usuario
                aiLearningSystem.updateUserKnowledge('formula', true);
            }, 1500);
        }
        
        // FunciÃ³n para parsear y analizar la fÃ³rmula
        function parseFormula(formula) {
            // Limpiar y normalizar la fÃ³rmula
            const cleanFormula = formula.replace(/\s+/g, '');
            
            // Validar caracteres permitidos
            if (!/^[a-zA-ZÂ¬â§â¨ââ()]+$/.test(cleanFormula)) {
                return {
                    valid: false,
                    error: "La fÃ³rmula contiene caracteres no vÃ¡lidos. Solo se permiten letras (variables) y los operadores lÃ³gicos: Â¬, â§, â¨, â, â"
                };
            }
            
            // Validar parÃ©ntesis balanceados
            if (!areParenthesesBalanced(cleanFormula)) {
                return {
                    valid: false,
                    error: "Los parÃ©ntesis no estÃ¡n balanceados correctamente"
                };
            }
            
            // Extraer variables
            const variables = extractVariables(cleanFormula);
            
            // Generar tabla de verdad
            const truthTable = generateTruthTable(cleanFormula, variables);
            
            // Simplificar la expresiÃ³n (si es posible)
            const simplified = simplifyExpression(cleanFormula);
            
            // Determinar si es tautologÃ­a, contradicciÃ³n o contingencia
            const expressionType = determineExpressionType(truthTable);
            
            return {
                valid: true,
                formula: cleanFormula,
                variables: variables,
                truthTable: truthTable,
                simplified: simplified,
                type: expressionType,
                steps: generateSolutionSteps(cleanFormula, variables)
            };
        }
        
        // FunciÃ³n para verificar parÃ©ntesis balanceados
        function areParenthesesBalanced(formula) {
            let balance = 0;
            
            for (let char of formula) {
                if (char === '(') balance++;
                if (char === ')') balance--;
                
                if (balance < 0) return false;
            }
            
            return balance === 0;
        }
        
        // FunciÃ³n para extraer variables de la fÃ³rmula
        function extractVariables(formula) {
            const variables = new Set();
            
            for (let char of formula) {
                if (/[a-zA-Z]/.test(char)) {
                    variables.add(char);
                }
            }
            
            return Array.from(variables).sort();
        }
        
        // FunciÃ³n para generar la tabla de verdad
        function generateTruthTable(formula, variables) {
            const rows = Math.pow(2, variables.length);
            const table = [];
            
            // Generar todas las combinaciones de valores de verdad
            for (let i = 0; i < rows; i++) {
                const row = {};
                
                // Asignar valores a las variables
                for (let j = 0; j < variables.length; j++) {
                    const variable = variables[j];
                    // Usar bits para representar valores de verdad
                    row[variable] = Boolean((i >> (variables.length - 1 - j)) & 1);
                }
                
                // Evaluar la fÃ³rmula con estos valores
                row.result = evaluateFormula(formula, row);
                table.push(row);
            }
            
            return table;
        }
        
        // FunciÃ³n para evaluar una fÃ³rmula con valores dados
        function evaluateFormula(formula, values) {
            // Convertir la fÃ³rmula a notaciÃ³n que JavaScript pueda evaluar
            let jsFormula = formula
                .replace(/Â¬/g, '!')
                .replace(/â§/g, '&&')
                .replace(/â¨/g, '||')
                .replace(/â/g, '=>')
                .replace(/â/g, '==');
            
            // Reemplazar variables con sus valores
            for (let variable in values) {
                const regex = new RegExp(variable, 'g');
                jsFormula = jsFormula.replace(regex, values[variable]);
            }
            
            // Reemplazar el operador => (implicaciÃ³n) con su equivalente lÃ³gico
            jsFormula = jsFormula.replace(/=>/g, '? !');
            
            // Evaluar la expresiÃ³n
            try {
                // Para manejar la implicaciÃ³n (p â q equivale a Â¬p â¨ q)
                if (jsFormula.includes('?')) {
                    const parts = jsFormula.split('?');
                    if (parts.length === 2) {
                        const [left, right] = parts;
                        return !eval(left) || eval(right);
                    }
                }
                
                return eval(jsFormula);
            } catch (e) {
                console.error("Error evaluando fÃ³rmula:", e);
                return null;
            }
        }
        
        // FunciÃ³n para simplificar una expresiÃ³n (versiÃ³n bÃ¡sica)
        function simplifyExpression(formula) {
            // Esta es una simplificaciÃ³n bÃ¡sica, se puede mejorar
            let simplified = formula
                .replace(/Â¬Â¬/g, '') // Doble negaciÃ³n
                .replace(/\(([a-zA-Z])\)/g, '$1'); // ParÃ©ntesis innecesarios alrededor de variables
            
            // Intenta algunas simplificaciones comunes
            if (formula === '(pâ§q)â¨(pâ§Â¬q)') return 'p';
            if (formula === '(pâ¨q)â§(pâ¨Â¬q)') return 'p';
            if (formula === 'pâ¨Â¬p') return '1'; // TautologÃ­a
            if (formula === 'pâ§Â¬p') return '0'; // ContradicciÃ³n
            
            return simplified;
        }
        
        // FunciÃ³n para determinar el tipo de expresiÃ³n
        function determineExpressionType(truthTable) {
            const allTrue = truthTable.every(row => row.result);
            const allFalse = truthTable.every(row => !row.result);
            
            if (allTrue) return 'tautologÃ­a';
            if (allFalse) return 'contradicciÃ³n';
            return 'contingencia';
        }
        
        // FunciÃ³n para generar pasos de soluciÃ³n
        function generateSolutionSteps(formula, variables) {
            const steps = [];
            
            steps.push(`1. Identificamos las variables: ${variables.join(', ')}`);
            steps.push(`2. La fÃ³rmula a evaluar es: ${formula}`);
            steps.push(`3. Construimos la tabla de verdad con ${Math.pow(2, variables.length)} filas`);
            steps.push("4. Evaluamos la fÃ³rmula para cada combinaciÃ³n de valores");
            
            // AÃ±adir mÃ¡s pasos segÃºn la complejidad de la fÃ³rmula
            if (formula.includes('â')) {
                steps.push("5. Recordemos que p â q es equivalente a Â¬p â¨ q");
            }
            
            if (formula.includes('â')) {
                steps.push("5. Recordemos que p â q es equivalente a (p â q) â§ (q â p)");
            }
            
            return steps;
        }
        
        // FunciÃ³n para mostrar los resultados del anÃ¡lisis
        function displayFormulaResult(result, originalFormula) {
            const resultContainer = document.getElementById('formulaResult');
            
            if (!result.valid) {
                resultContainer.innerHTML = `
                    <div style="color: var(--accent);">
                        <h4><i class="fas fa-exclamation-circle"></i> Error en la fÃ³rmula</h4>
                        <p>${result.error}</p>
                    </div>
                `;
                resultContainer.style.display = 'block';
                return;
            }
            
            let html = `
                <h4><i class="fas fa-check-circle" style="color: var(--success);"></i> AnÃ¡lisis de: ${originalFormula}</h4>
                <p><strong>Variables identificadas:</strong> ${result.variables.join(', ')}</p>
                <p><strong>Tipo de expresiÃ³n:</strong> ${result.type}</p>
            `;
            
            if (result.simplified && result.simplified !== result.formula) {
                html += `
                    <div class="simplified-formula">
                        <strong>FÃ³rmula simplificada:</strong> ${result.simplified}
                    </div>
                `;
            }
            
            html += `
                <h5>Tabla de Verdad:</h5>
                <table class="evaluation-table">
                    <tr>
                        ${result.variables.map(v => `<th>${v}</th>`).join('')}
                        <th>Resultado</th>
                    </tr>
            `;
            
            result.truthTable.forEach(row => {
                html += `
                    <tr>
                        ${result.variables.map(v => `<td>${row[v] ? 'V' : 'F'}</td>`).join('')}
                        <td><strong>${row.result ? 'V' : 'F'}</strong></td>
                    </tr>
                `;
            });
            
            html += `
                </table>
                <div class="evaluation-steps">
                    <h5>Pasos de la soluciÃ³n:</h5>
                    ${result.steps.map(step => `<div class="step">${step}</div>`).join('')}
                </div>
            `;
            
            resultContainer.innerHTML = html;
            resultContainer.style.display = 'block';
        }

        // Configurar arrastrar y soltar
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageUpload(files);
            }
        });

        // InicializaciÃ³n
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos de aprendizaje previos
            aiLearningSystem.loadFromLocalStorage();
            
            // Configurar el primer ejercicio
            loadExercise();
            
            // AÃ±adir mensaje de bienvenida del asistente
            setTimeout(() => {
                addMessage("Ahora puedo analizar fÃ³rmulas lÃ³gicas que me escribas. Usa el botÃ³n 'Resolver FÃ³rmula' para probarlo.", "ai");
            }, 1000);
        });
    </script>
</body>
</html>