<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador IA Avanzado - Lógica Proposicional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --info: #3498db;
            --ai-bubble: #e3f2fd;
            --user-bubble: #f0f4f8;
            --learning: #9b59b6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            grid-template-areas: 
                "header header"
                "problem assistant"
                "footer footer";
        }
        
        header {
            grid-area: header;
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: relative;
        }
        
        .learning-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--learning);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .problem-section {
            grid-area: problem;
            padding: 20px;
            background: var(--light);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .assistant-section {
            grid-area: assistant;
            padding: 20px;
            background: white;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #eee;
            position: relative;
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
        }
        
        .exercise {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .exercise-content {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid var(--secondary);
        }
        
        .input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            border-color: var(--secondary);
            outline: none;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: var(--success);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-danger {
            background: var(--accent);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-learning {
            background: var(--learning);
            color: white;
        }
        
        .btn-learning:hover {
            background: #8e44ad;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .upload-area:hover {
            border-color: var(--secondary);
            background-color: #f8f9fa;
        }
        
        .upload-area.drag-over {
            border-color: var(--secondary);
            background-color: #e3f2fd;
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #7f8c8d;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 15px;
            border-radius: 8px;
            display: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            max-height: 400px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .message {
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .ai-message {
            align-self: flex-start;
            background: var(--ai-bubble);
            border-bottom-left-radius: 4px;
        }
        
        .user-message {
            align-self: flex-end;
            background: var(--user-bubble);
            border-bottom-right-radius: 4px;
        }
        
        .message-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .message-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 20px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .message-input input:focus {
            border-color: var(--secondary);
        }
        
        .send-btn {
            background: var(--secondary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .send-btn:hover {
            background: #2980b9;
        }
        
        .solution-step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .step-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .correct {
            border-left: 4px solid var(--success);
        }
        
        .incorrect {
            border-left: 4px solid var(--accent);
        }
        
        .feedback {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: #ffeaa7;
            border-left: 4px solid var(--warning);
        }
        
        .truth-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .truth-table th, .truth-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .truth-table th {
            background: var(--primary);
            color: white;
        }
        
        .truth-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .circuit-diagram {
            font-family: monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            white-space: pre;
            overflow-x: auto;
        }
        
        footer {
            grid-area: footer;
            text-align: center;
            padding: 20px;
            background: var(--dark);
            color: white;
        }
        
        .analysis-progress {
            height: 5px;
            width: 100%;
            background: #eee;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: var(--secondary);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        
        .exercise-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .exercise-type-btn {
            padding: 8px 15px;
            background: #e0e0e0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .exercise-type-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        .hint-box {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid var(--info);
        }
        
        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        .feedback-btn {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .feedback-btn:hover {
            background: #e0e0e0;
        }
        
        .feedback-btn.helpful {
            color: var(--success);
        }
        
        .feedback-btn.not-helpful {
            color: var(--accent);
        }
        
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .suggestion-chip {
            padding: 8px 15px;
            background: #e3f2fd;
            border-radius: 18px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .suggestion-chip:hover {
            background: #d0e5fc;
        }
        
        .user-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .progress-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .progress-tracker {
            flex: 1;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-value {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }
        
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "problem"
                    "assistant"
                    "footer";
            }
            
            .assistant-section {
                border-left: none;
                border-top: 1px solid #eee;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
        
        .typing-indicator {
            display: flex;
            padding: 10px;
            background: var(--ai-bubble);
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 10px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            margin: 0 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        .learning-notice {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--learning);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s;
        }
        
        .learning-notice.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="learning-badge">
                <i class="fas fa-brain"></i> IA con Aprendizaje
            </div>
            <h1><i class="fas fa-robot"></i> Analizador IA Avanzado - Lógica Proposicional</h1>
            <p class="subtitle">IA mejorada que aprende de tus interacciones y mejora sus explicaciones</p>
        </header>
        
        <div class="problem-section">
            <h2><i class="fas fa-pencil-alt"></i> Ejercicio Actual</h2>
            
            <div class="exercise-selector">
                <button class="exercise-type-btn active" onclick="changeExerciseType('basic')">Básico</button>
                <button class="exercise-type-btn" onclick="changeExerciseType('truth-table')">Tablas de Verdad</button>
                <button class="exercise-type-btn" onclick="changeExerciseType('circuit')">Circuitos Lógicos</button>
            </div>
            
            <div class="exercise">
                <h3>Problema #1 <span class="exercise-difficulty">(Básico)</span></h3>
                <div class="exercise-content">
                    Dadas las proposiciones:
                    p: "5 es un número primo"
                    q: "4 < 2"
                    
                    Determine el valor de verdad de:
                    p ∧ q, p ∨ q, p → q
                </div>
                
                <div class="hint-box">
                    <strong><i class="fas fa-lightbulb"></i> Sugerencia:</strong> Recuerda que una conjunción (∧) es verdadera solo cuando ambas proposiciones son verdaderas.
                </div>
            </div>
            
            <div class="input-area">
                <h3><i class="fas fa-edit"></i> Tu respuesta:</h3>
                <textarea id="userSolution" placeholder="Escribe tu solución paso a paso aquí..."></textarea>
                
                <div class="buttons">
                    <button class="btn-primary" onclick="checkSolution()">
                        <i class="fas fa-check-circle"></i> Verificar solución
                    </button>
                    <button class="btn-secondary" onclick="showSolution()">
                        <i class="fas fa-eye"></i> Mostrar solución
                    </button>
                    <button class="btn-warning" onclick="newExercise()">
                        <i class="fas fa-plus-circle"></i> Nuevo ejercicio
                    </button>
                    <button class="btn-learning" onclick="adaptiveExplanation()">
                        <i class="fas fa-graduation-cap"></i> Explicación Adaptativa
                    </button>
                    <button class="btn-danger" onclick="clearAll()">
                        <i class="fas fa-trash"></i> Limpiar
                    </button>
                </div>
            </div>
            
            <div class="user-progress">
                <span class="progress-label">Tu progreso:</span>
                <div class="progress-tracker">
                    <div class="progress-value" id="progressValue" style="width: 0%"></div>
                </div>
                <span id="progressPercent">0%</span>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleImageUpload(this.files)">
                <div class="upload-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <p>Haz clic o arrastra una imagen de un ejercicio para analizarlo</p>
                <img id="imagePreview" class="image-preview" alt="Vista previa de la imagen">
                <div class="analysis-progress" id="progressBar">
                    <div class="progress-bar" id="progressFill"></div>
                </div>
            </div>
            
            <div class="feedback" id="feedbackSection">
                <h3><i class="fas fa-comment-dots"></i> Retroalimentación</h3>
                <p>Aquí verás el análisis de tu respuesta y correcciones si es necesario.</p>
            </div>
        </div>
        
        <div class="assistant-section">
            <div class="learning-notice" id="learningNotice">
                <i class="fas fa-sync-alt"></i> Aprendiendo de tu interacción...
            </div>
            
            <h2><i class="fas fa-robot"></i> Asistente IA Avanzado</h2>
            
            <div class="chat-container" id="chatContainer">
                <div class="message ai-message">
                    ¡Hola! Soy tu asistente avanzado de lógica proposicional. Analizaré tus respuestas escritas y aprenderé de nuestras interacciones para mejorar mis explicaciones.
                </div>
                <div class="message ai-message">
                    Puedes escribir tus soluciones, subir imágenes de problemas o hacerme preguntas directas.
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" onclick="sendSuggestion('¿Cómo funciona la conjunción?')">¿Cómo funciona la conjunción?</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('Explícame las tablas de verdad')">Explícame las tablas de verdad</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('Necesito un ejemplo de circuito')">Necesito un ejemplo de circuito</div>
                    </div>
                </div>
            </div>
            
            <div class="message-input">
                <input type="text" id="userInput" placeholder="Escribe tu pregunta aquí..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <footer>
            <p>Analizador IA Avanzado de Lógica Proposicional - Basado en "Fundamentos de la Matemática" de Jorge Sáenz</p>
        </footer>
    </div>

    <script>
        // Ejercicios predefinidos por tipo
        const exercises = {
            basic: [
                {
                    id: 1,
                    content: `Dadas las proposiciones:
p: "5 es un número primo"
q: "4 < 2"
                        
Determine el valor de verdad de:
p ∧ q, p ∨ q, p → q`,
                    solution: {
                        steps: [
                            "p: '5 es un número primo' → Verdadero (1)",
                            "q: '4 < 2' → Falso (0)",
                            "p ∧ q = 1 ∧ 0 = 0 (Falso)",
                            "p ∨ q = 1 ∨ 0 = 1 (Verdadero)",
                            "p → q = 1 → 0 = 0 (Falso)"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `Dadas las proposiciones:
p: "π es un número racional"
q: "√4 = 2"
                        
Determine el valor de verdad de:
p ∨ q, p ∧ q, ¬p`,
                    solution: {
                        steps: [
                            "p: 'π es un número racional' → Falso (0)",
                            "q: '√4 = 2' → Verdadero (1)",
                            "p ∨ q = 0 ∨ 1 = 1 (Verdadero)",
                            "p ∧ q = 0 ∧ 1 = 0 (Falso)",
                            "¬p = ¬0 = 1 (Verdadero)"
                        ]
                    }
                }
            ],
            "truth-table": [
                {
                    id: 1,
                    content: `Construya la tabla de verdad para la proposición:
(p ∨ q) ∧ ¬p`,
                    solution: {
                        steps: [
                            "Primero identificamos las variables: p, q",
                            "Construimos las columnas para p, q, p ∨ q, ¬p, y (p ∨ q) ∧ ¬p",
                            "Completamos todas las combinaciones posibles de valores de verdad",
                            "Evaluamos p ∨ q para cada combinación",
                            "Evaluamos ¬p para cada combinación",
                            "Finalmente evaluamos (p ∨ q) ∧ ¬p"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `Construya la tabla de verdad para la proposición:
(p → q) ∧ (q → p)`,
                    solution: {
                        steps: [
                            "Esta expresión es equivalente a p ↔ q (bicondicional)",
                            "La bicondicional es verdadera cuando p y q tienen el mismo valor de verdad",
                            "Construimos la tabla con todas las combinaciones de p y q",
                            "Evaluamos p → q para cada combinación",
                            "Evaluamos q → p para cada combinación",
                            "Finalmente evaluamos la conjunción de ambos condicionales"
                        ]
                    }
                }
            ],
            circuit: [
                {
                    id: 1,
                    content: `Diseñe el circuito lógico para la expresión:
(p ∧ q) ∨ (¬p ∧ r)`,
                    solution: {
                        steps: [
                            "Identificamos las compuertas necesarias: AND, OR y NOT",
                            "Diseñamos la parte (p ∧ q) con una compuerta AND",
                            "Diseñamos la parte (¬p ∧ r) con un NOT seguido de una AND",
                            "Combinamos ambas partes con una compuerta OR",
                            "Dibujamos el diagrama completo del circuito"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `Diseñe el circuito lógico para la expresión:
¬(p ∨ q) ∧ r`,
                    solution: {
                        steps: [
                            "Identificamos las compuertas necesarias: OR, NOT y AND",
                            "Primero diseñamos (p ∨ q) con una compuerta OR",
                            "Aplicamos la negación ¬(p ∨ q) con una compuerta NOT",
                            "Finalmente combinamos con r usando una compuerta AND",
                            "Dibujamos el diagrama completo del circuito"
                        ]
                    }
                }
            ]
        };

        // Sistema de aprendizaje de la IA
        const aiLearningSystem = {
            userKnowledge: {
                basic: { score: 0, attempts: 0, correct: 0 },
                truthTable: { score: 0, attempts: 0, correct: 0 },
                circuit: { score: 0, attempts: 0, correct: 0 }
            },
            explanationLevel: 1, // 1: Básico, 2: Intermedio, 3: Avanzado
            userPreferences: {
                detailedExplanations: true,
                examples: true,
                visualAids: true
            },
            conversationHistory: [],
            feedbackHistory: [],
            
            // Aprender de la retroalimentación del usuario
            learnFromFeedback: function(messageId, wasHelpful, feedbackText = "") {
                this.feedbackHistory.push({
                    messageId,
                    wasHelpful,
                    feedbackText,
                    timestamp: new Date()
                });
                
                // Ajustar el nivel de explicación según la retroalimentación
                if (wasHelpful) {
                    this.explanationLevel = Math.min(3, this.explanationLevel + 0.1);
                    showLearningNotice("¡Gracias por tu feedback! Estoy mejorando mis explicaciones.");
                } else {
                    this.explanationLevel = Math.max(1, this.explanationLevel - 0.2);
                    showLearningNotice("Ajustando mis explicaciones basado en tu feedback...");
                    
                    // Si hay texto de retroalimentación, aprender de él
                    if (feedbackText) {
                        this.learnFromTextFeedback(feedbackText);
                    }
                }
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Aprender del texto de retroalimentación
            learnFromTextFeedback: function(feedbackText) {
                const lowerFeedback = feedbackText.toLowerCase();
                
                // Detectar solicitudes de más detalle
                if (lowerFeedback.includes("más detalle") || lowerFeedback.includes("explica mejor") || 
                    lowerFeedback.includes("no entiendo")) {
                    this.userPreferences.detailedExplanations = true;
                }
                
                // Detectar solicitudes de ejemplos
                if (lowerFeedback.includes("ejemplo") || lowerFeedback.includes("ejempl")) {
                    this.userPreferences.examples = true;
                }
                
                // Detectar solicitudes de ayudas visuales
                if (lowerFeedback.includes("visual") || lowerFeedback.includes("gráfico") || 
                    lowerFeedback.includes("diagrama")) {
                    this.userPreferences.visualAids = true;
                }
            },
            
            // Aprender del historial de conversación
            learnFromConversation: function() {
                // Analizar el historial de conversación para mejorar
                const lastFiveMessages = this.conversationHistory.slice(-5);
                
                // Contar preguntas del usuario
                const userQuestions = lastFiveMessages.filter(msg => msg.sender === 'user').length;
                
                // Si el usuario hace muchas preguntas, puede necesitar explicaciones más detalladas
                if (userQuestions >= 3) {
                    this.userPreferences.detailedExplanations = true;
                    this.explanationLevel = Math.min(3, this.explanationLevel + 0.2);
                }
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Actualizar el conocimiento del usuario
            updateUserKnowledge: function(topic, isCorrect) {
                if (!this.userKnowledge[topic]) {
                    this.userKnowledge[topic] = { score: 0, attempts: 0, correct: 0 };
                }
                
                this.userKnowledge[topic].attempts++;
                if (isCorrect) {
                    this.userKnowledge[topic].correct++;
                }
                
                this.userKnowledge[topic].score = this.userKnowledge[topic].correct / this.userKnowledge[topic].attempts;
                
                // Actualizar barra de progreso
                updateProgressBar();
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Obtener explicación adaptada al usuario
            getAdaptedExplanation: function(topic, baseExplanation) {
                let explanation = baseExplanation;
                
                // Añadir más detalle si es necesario
                if (this.userPreferences.detailedExplanations) {
                    explanation += this.getAdditionalDetails(topic);
                }
                
                // Añadir ejemplos si es necesario
                if (this.userPreferences.examples) {
                    explanation += this.getExample(topic);
                }
                
                // Ajustar según el nivel de explicación
                if (this.explanationLevel < 2) {
                    // Explicación más simple
                    explanation = explanation.replace(/términos técnicos/g, "conceptos")
                                             .replace(/En lógica proposicional/g, "En este tema");
                } else if (this.explanationLevel > 2) {
                    // Explicación más avanzada
                    explanation += this.getAdvancedInsight(topic);
                }
                
                return explanation;
            },
            
            // Obtener detalles adicionales según el tema
            getAdditionalDetails: function(topic) {
                const details = {
                    basic: "\n\nRecuerda que en lógica proposicional trabajamos con valores de verdad binarios: verdadero (1) y falso (0).",
                    truthTable: "\n\nCada variable proposicional tiene dos valores posibles, por lo que para n variables necesitarás 2^n filas en tu tabla de verdad.",
                    circuit: "\n\nLas compuertas lógicas se pueden combinar de muchas formas para crear circuitos más complejos que representen expresiones lógicas."
                };
                
                return details[topic] || "";
            },
            
            // Obtener ejemplos según el tema
            getExample: function(topic) {
                const examples = {
                    basic: "\n\nPor ejemplo, si p es verdadero y q es falso, entonces p ∧ q es falso, pero p ∨ q es verdadero.",
                    truthTable: "\n\nPor ejemplo, para una expresión con 2 variables, la tabla de verdad tendrá 4 filas que representan todas las combinaciones posibles.",
                    circuit: "\n\nPor ejemplo, la expresión p ∧ q se representaría con una compuerta AND que toma las entradas p y q."
                };
                
                return examples[topic] || "";
            },
            
            // Obtener información avanzada según el tema
            getAdvancedInsight: function(topic) {
                const insights = {
                    basic: "\n\nDesde una perspectiva más avanzada, puedes notar que el operador condicional (→) no es conmutativo, a diferencia de la conjunción y disyunción.",
                    truthTable: "\n\nUna perspectiva avanzada: las tablas de verdad son la base para la implementación de circuitos digitales y álgebra booleana.",
                    circuit: "\n\nPerspectiva avanzada: estos circuitos lógicos son la base de los procesadores modernos y se implementan físicamente con transistores."
                };
                
                return insights[topic] || "";
            },
            
            // Guardar en localStorage
            saveToLocalStorage: function() {
                const data = {
                    userKnowledge: this.userKnowledge,
                    explanationLevel: this.explanationLevel,
                    userPreferences: this.userPreferences,
                    feedbackHistory: this.feedbackHistory
                };
                
                localStorage.setItem('aiLearningData', JSON.stringify(data));
            },
            
            // Cargar desde localStorage
            loadFromLocalStorage: function() {
                const data = JSON.parse(localStorage.getItem('aiLearningData'));
                if (data) {
                    this.userKnowledge = data.userKnowledge || this.userKnowledge;
                    this.explanationLevel = data.explanationLevel || this.explanationLevel;
                    this.userPreferences = data.userPreferences || this.userPreferences;
                    this.feedbackHistory = data.feedbackHistory || this.feedbackHistory;
                    
                    // Actualizar barra de progreso
                    updateProgressBar();
                }
            }
        };

        let currentExerciseType = 'basic';
        let currentExerciseIndex = 0;
        let messageCounter = 0;

        // Respuestas predefinidas del asistente IA mejorado
        const aiResponses = {
            "hola": "¡Hola! Soy tu asistente avanzado de lógica proposicional. Puedo analizar tus respuestas escritas, explicarte conceptos y ayudarte a resolver problemas. ¿En qué necesitas ayuda?",
            "ayuda": "Puedo ayudarte con: valores de verdad, tablas de verdad, circuitos lógicos, equivalencias lógicas y más. También puedo analizar tus respuestas escritas y proporcionarte retroalimentación detallada.",
            "verdad": "El valor de verdad de una proposición es su cualidad de ser verdadera (1) o falsa (0). En lógica proposicional, trabajamos con estos dos valores.",
            "conjuncion": "La conjunción (p ∧ q) es verdadera solo cuando ambas proposiciones son verdaderas. Su tabla de verdad es: p=1, q=1 → 1; p=1, q=0 → 0; p=0, q=1 → 0; p=0, q=0 → 0.",
            "disyuncion": "La disyunción (p ∨ q) es falsa solo cuando ambas proposiciones son falsas. Su tabla de verdad es: p=1, q=1 → 1; p=1, q=0 → 1; p=0, q=1 → 1; p=0, q=0 → 0.",
            "condicional": "El condicional (p → q) es falso solo cuando p es verdadera y q es falsa. Su tabla de verdad es: p=1, q=1 → 1; p=1, q=0 → 0; p=0, q=1 → 1; p=0, q=0 → 1.",
            "tabla": "Una tabla de verdad muestra todos los posibles valores de verdad de una proposición compuesta. Para n variables, hay 2^n combinaciones posibles.",
            "circuito": "Los circuitos lógicos representan proposiciones usando compuertas AND, OR y NOT. Cada compuerta corresponde a un operador lógico específico.",
            "default": "No estoy seguro de entender completamente. ¿Podrías reformular tu pregunta o ser más específico? Estoy aquí para ayudarte con conceptos de lógica proposicional."
        };

        // Función para mostrar notificación de aprendizaje
        function showLearningNotice(message) {
            const notice = document.getElementById('learningNotice');
            notice.textContent = message;
            notice.classList.add('show');
            
            setTimeout(() => {
                notice.classList.remove('show');
            }, 3000);
        }

        // Función para actualizar la barra de progreso
        function updateProgressBar() {
            const knowledge = aiLearningSystem.userKnowledge;
            let totalScore = 0;
            let totalTopics = 0;
            
            for (const topic in knowledge) {
                if (knowledge[topic].attempts > 0) {
                    totalScore += knowledge[topic].score;
                    totalTopics++;
                }
            }
            
            const overallProgress = totalTopics > 0 ? (totalScore / totalTopics) * 100 : 0;
            
            document.getElementById('progressValue').style.width = `${overallProgress}%`;
            document.getElementById('progressPercent').textContent = `${Math.round(overallProgress)}%`;
        }

        // Función para cambiar el tipo de ejercicio
        function changeExerciseType(type) {
            currentExerciseType = type;
            currentExerciseIndex = 0;
            
            // Actualizar botones activos
            document.querySelectorAll('.exercise-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Cargar nuevo ejercicio
            loadExercise();
            
            addMessage(`He cambiado a ejercicios de ${getExerciseTypeName(type)}. ¿Necesitas ayuda con este tipo de problemas?`, "ai");
        }
        
        function getExerciseTypeName(type) {
            const names = {
                'basic': 'lógica básica',
                'truth-table': 'tablas de verdad',
                'circuit': 'circuitos lógicos'
            };
            return names[type] || type;
        }
        
        // Función para cargar el ejercicio actual
        function loadExercise() {
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            document.querySelector('.exercise-content').textContent = exercise.content;
            document.querySelector('.exercise-difficulty').textContent = `(${getExerciseTypeName(currentExerciseType)})`;
            
            // Limpiar feedback
            document.getElementById('feedbackSection').innerHTML = `
                <h3><i class="fas fa-comment-dots"></i> Retroalimentación</h3>
                <p>Aquí verás el análisis de tu respuesta y correcciones si es necesario.</p>
            `;
            
            // Limpiar área de texto
            document.getElementById('userSolution').value = '';
        }

        // Función mejorada para verificar la solución con IA avanzada
        function checkSolution() {
            const userSolution = document.getElementById('userSolution').value;
            const feedbackSection = document.getElementById('feedbackSection');
            
            if (!userSolution.trim()) {
                feedbackSection.innerHTML = `
                    <h3><i class="fas fa-exclamation-triangle"></i> Retroalimentación</h3>
                    <p>Por favor, escribe tu solución antes de verificar.</p>
                `;
                return;
            }
            
            // Mostrar indicador de typing
            showTypingIndicator();
            
            // Simular procesamiento con IA
            setTimeout(() => {
                // Análisis avanzado de la respuesta (simulación de IA mejorada)
                const exercise = exercises[currentExerciseType][currentExerciseIndex];
                let feedbackHTML = `
                    <h3><i class="fas fa-comment-dots"></i> Análisis Detallado de tu Respuesta</h3>
                `;
                
                // Análisis basado en el tipo de ejercicio
                if (currentExerciseType === 'basic') {
                    feedbackHTML += analyzeBasicSolution(userSolution, exercise);
                    // Actualizar conocimiento del usuario
                    aiLearningSystem.updateUserKnowledge('basic', true);
                } else if (currentExerciseType === 'truth-table') {
                    feedbackHTML += analyzeTruthTableSolution(userSolution, exercise);
                    aiLearningSystem.updateUserKnowledge('truthTable', true);
                } else if (currentExerciseType === 'circuit') {
                    feedbackHTML += analyzeCircuitSolution(userSolution, exercise);
                    aiLearningSystem.updateUserKnowledge('circuit', true);
                }
                
                feedbackSection.innerHTML = feedbackHTML;
                
                // Añadir mensaje del asistente
                addMessage("He analizado tu solución en detalle. ¿Hay algún concepto específico que te gustaría que explique más a fondo?", "ai");
                
                // Aprender de la conversación
                aiLearningSystem.learnFromConversation();
            }, 2000);
        }

        // Función para analizar soluciones de lógica básica
        function analyzeBasicSolution(userSolution, exercise) {
            let analysis = '';
            const lowerSolution = userSolution.toLowerCase();
            
            // Detectar valores de verdad correctos
            if (lowerSolution.includes("verdadero") || lowerSolution.includes("1") || lowerSolution.includes("true")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado valores verdaderos adecuadamente.</p>`;
            }
            
            if (lowerSolution.includes("falso") || lowerSolution.includes("0") || lowerSolution.includes("false")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado valores falsos adecuadamente.</p>`;
            }
            
            // Detectar operadores lógicos
            if (lowerSolution.includes("∧") || lowerSolution.includes("y") || lowerSolution.includes("conjunción")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido la conjunción (∧).</p>`;
            }
            
            if (lowerSolution.includes("∨") || lowerSolution.includes("o") || lowerSolution.includes("disyunción")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido la disyunción (∨).</p>`;
            }
            
            if (lowerSolution.includes("→") || lowerSolution.includes("entonces") || lowerSolution.includes("condicional")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido el condicional (→).</p>`;
            }
            
            // Detectar posibles errores
            if (!lowerSolution.includes("falso") && !lowerSolution.includes("0") && !lowerSolution.includes("false")) {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: No parece que hayas identificado valores falsos. Recuerda que p ∧ q es falso cuando al menos una proposición es falsa.</p>`;
            }
            
            if ((lowerSolution.includes("verdadero") || lowerSolution.includes("1")) && 
                !lowerSolution.includes("falso") && !lowerSolution.includes("0")) {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Parece que solo has identificado valores verdaderos. Recuerda que en lógica proposicional hay dos valores posibles: verdadero y falso.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Siempre verifica ambos valores de verdad (verdadero y falso) para cada operación lógica.</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi análisis detectó que comprendes los conceptos básicos, pero debes prestar atención a los casos donde las proposiciones son falsas.</p>
            `;
            
            return analysis;
        }

        // Función para analizar soluciones de tablas de verdad
        function analyzeTruthTableSolution(userSolution, exercise) {
            let analysis = `
                <p><i class="fas fa-check-circle" style="color: var(--success);"></i> He detectado que estás trabajando con tablas de verdad.</p>
            `;
            
            if (userSolution.includes("combinación") || userSolution.includes("combinaciones")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has considerado las combinaciones de valores de verdad.</p>`;
            } else {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Para tablas de verdad, es importante considerar todas las combinaciones posibles de valores de verdad.</p>`;
            }
            
            if (userSolution.includes("variable") || userSolution.includes("variables")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado las variables proposicionales.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Para n variables, una tabla de verdad tiene 2^n filas. Asegúrate de incluir todas las combinaciones posibles.</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi análisis sugiere que comprendes la estructura de las tablas de verdad, pero debes verificar que hayas incluido todas las combinaciones posibles.</p>
            `;
            
            return analysis;
        }

        // Función para analizar soluciones de circuitos lógicos
        function analyzeCircuitSolution(userSolution, exercise) {
            let analysis = `
                <p><i class="fas fa-check-circle" style="color: var(--success);"></i> He detectado que estás trabajando con circuitos lógicos.</p>
            `;
            
            if (userSolution.includes("compuerta") || userSolution.includes("compuertas")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado las compuertas lógicas.</p>`;
            } else {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Para circuitos lógicos, es importante identificar las compuertas (AND, OR, NOT) correspondientes.</p>`;
            }
            
            if (userSolution.includes("AND") || userSolution.includes("OR") || userSolution.includes("NOT")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido los tipos de compuertas lógicas.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Recuerda que AND representa la conjunción (∧), OR la disyunción (∨) y NOT la negación (¬).</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi análisis indica que comprendes la relación entre operadores lógicos y compuertas, pero asegúrate de verificar todas las conexiones en tu circuito.</p>
            `;
            
            return analysis;
        }

        // Función para mostrar la solución completa
        function showSolution() {
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            addMessage("Claro, aquí está la solución paso a paso para el ejercicio actual:", "ai");
            
            // Mostrar indicador de typing
            showTypingIndicator();
            
            // Mostrar pasos de solución después de un breve delay
            setTimeout(() => {
                exercise.solution.steps.forEach((step, index) => {
                    setTimeout(() => {
                        addMessage(step, "ai");
                        
                        // Preguntar si necesita ayuda después del último paso
                        if (index === exercise.solution.steps.length - 1) {
                            setTimeout(() => {
                                addMessage("¿Te quedó claro? ¿Necesitas que explique algún paso en detalle?", "ai");
                            }, 500);
                        }
                    }, (index + 1) * 800);
                });
            }, 1000);
        }

        // Función para generar un nuevo ejercicio
        function newExercise() {
            // Avanzar al siguiente ejercicio (circular)
            currentExerciseIndex = (currentExerciseIndex + 1) % exercises[currentExerciseType].length;
            loadExercise();
            
            addMessage(`He generado un nuevo ejercicio de ${getExerciseTypeName(currentExerciseType)}. ¿Necesitas ayuda para resolverlo?`, "ai");
        }

        // Función para proporcionar una explicación adaptativa
        function adaptiveExplanation() {
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            let explanation = "";
            
            // Obtener explicación base según el tipo de ejercicio
            if (currentExerciseType === 'basic') {
                explanation = "Para resolver este ejercicio de lógica básica, debes seguir estos pasos:";
            } else if (currentExerciseType === 'truth-table') {
                explanation = "Para construir una tabla de verdad, sigue estos pasos:";
            } else if (currentExerciseType === 'circuit') {
                explanation = "Para diseñar un circuito lógico, considera estos pasos:";
            }
            
            // Obtener explicación adaptada
            explanation = aiLearningSystem.getAdaptedExplanation(currentExerciseType, explanation);
            
            // Añadir los pasos de la solución
            explanation += "\n\n" + exercise.solution.steps.join('\n');
            
            addMessage(explanation, "ai");
        }

        // Función para limpiar todo
        function clearAll() {
            document.getElementById('userSolution').value = '';
            document.getElementById('feedbackSection').innerHTML = `
                <h3><i class="fas fa-comment-dots"></i> Retroalimentación</h3>
                <p>Aquí verás el análisis de tu respuesta y correcciones si es necesario.</p>
            `;
            
            addMessage("He limpiado tu área de trabajo. ¿En qué puedo ayudarte ahora?", "ai");
        }

        // Función para mostrar indicador de typing
        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingIndicator = document.createElement('div');
            typingIndicator.classList.add('typing-indicator');
            typingIndicator.id = 'typingIndicator';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.classList.add('typing-dot');
                typingIndicator.appendChild(dot);
            }
            
            chatContainer.appendChild(typingIndicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Función para ocultar indicador de typing
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Función para manejar la subida de imágenes
        function handleImageUpload(files) {
            if (files.length > 0) {
                const file = files[0];
                const reader = new FileReader();
                
                // Mostrar vista previa de la imagen
                reader.onload = function(e) {
                    const preview = document.getElementById('imagePreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    
                    // Mostrar barra de progreso
                    const progressBar = document.getElementById('progressBar');
                    const progressFill = document.getElementById('progressFill');
                    progressBar.style.display = 'block';
                    
                    // Simular análisis progresivo
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 5;
                        progressFill.style.width = `${progress}%`;
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            simulateImageAnalysis(file);
                        }
                    }, 100);
                };
                
                reader.readAsDataURL(file);
            }
        }

        // Función para simular el análisis de imagen
        function simulateImageAnalysis(file) {
            addMessage("He recibido tu imagen. Estoy analizando el problema...", "ai");
            
            // Ocultar barra de progreso
            setTimeout(() => {
                document.getElementById('progressBar').style.display = 'none';
                
                // Simular diferentes tipos de análisis basados en el nombre del archivo
                const fileName = file.name.toLowerCase();
                
                if (fileName.includes("tabla") || fileName.includes("verdad")) {
                    addMessage("He detectado una tabla de verdad en tu imagen. Déjame analizarla...", "ai");
                    setTimeout(() => {
                        addMessage("La tabla de verdad corresponde a la expresión: (p ∨ q) ∧ ¬p", "ai");
                        addMessage("¿Te gustaría que te muestre cómo construir esta tabla paso a paso?", "ai");
                        
                        // Cambiar a ejercicios de tabla de verdad
                        changeExerciseType('truth-table');
                    }, 2000);
                } else if (fileName.includes("circuito") || fileName.includes("compuerta")) {
                    addMessage("Veo que has subido un diagrama de circuito lógico. Analizando...", "ai");
                    setTimeout(() => {
                        addMessage("El circuito corresponde a la expresión: (p ∧ q) ∨ (¬p ∧ r)", "ai");
                        addMessage("¿Quieres que te explique cómo funciona este circuito?", "ai");
                        
                        // Cambiar a ejercicios de circuitos
                        changeExerciseType('circuit');
                    }, 2000);
                } else {
                    addMessage("He detectado un ejercicio de lógica proposicional en tu imagen.", "ai");
                    setTimeout(() => {
                        addMessage("Parece ser un problema que involucra valores de verdad y operaciones lógicas.", "ai");
                        addMessage("¿Te gustaría que te guíe en la solución?", "ai");
                        
                        // Cambiar a ejercicios básicos
                        changeExerciseType('basic');
                    }, 2000);
                }
            }, 1500);
        }

        // Función para enviar mensaje al asistente
        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (message) {
                addMessage(message, "user");
                userInput.value = '';
                
                // Mostrar indicador de typing
                showTypingIndicator();
                
                // Simular思考过程
                setTimeout(() => {
                    hideTypingIndicator();
                    
                    // Buscar respuesta predefinida o usar default
                    const lowerMessage = message.toLowerCase();
                    let response = aiResponses.default;
                    
                    for (const [key, value] of Object.entries(aiResponses)) {
                        if (lowerMessage.includes(key)) {
                            response = value;
                            break;
                        }
                    }
                    
                    // Adaptar la respuesta según el sistema de aprendizaje
                    response = aiLearningSystem.getAdaptedExplanation(currentExerciseType, response);
                    
                    addMessage(response, "ai");
                    
                    // Aprender de la conversación
                    aiLearningSystem.learnFromConversation();
                }, 1500);
            }
        }
        
        // Función para enviar una sugerencia predefinida
        function sendSuggestion(suggestion) {
            document.getElementById('userInput').value = suggestion;
            sendMessage();
        }
        
        // Función para manejar la tecla Enter en el chat
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Función para añadir mensaje al chat con sistema de retroalimentación
        function addMessage(text, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(sender === 'ai' ? 'ai-message' : 'user-message');
            
            // Añadir ID único al mensaje para retroalimentación
            const messageId = `msg-${messageCounter++}`;
            messageElement.id = messageId;
            
            messageElement.textContent = text;
            
            // Añadir botones de retroalimentación para mensajes de IA
            if (sender === 'ai') {
                const feedbackButtons = document.createElement('div');
                feedbackButtons.classList.add('feedback-buttons');
                
                const helpfulBtn = document.createElement('button');
                helpfulBtn.classList.add('feedback-btn', 'helpful');
                helpfulBtn.innerHTML = '<i class="fas fa-thumbs-up"></i> Útil';
                helpfulBtn.onclick = function() {
                    aiLearningSystem.learnFromFeedback(messageId, true);
                    this.disabled = true;
                    notHelpfulBtn.disabled = true;
                };
                
                const notHelpfulBtn = document.createElement('button');
                notHelpfulBtn.classList.add('feedback-btn', 'not-helpful');
                notHelpfulBtn.innerHTML = '<i class="fas fa-thumbs-down"></i> No útil';
                notHelpfulBtn.onclick = function() {
                    const feedbackText = prompt("¿Cómo podría mejorar mi explicación?");
                    aiLearningSystem.learnFromFeedback(messageId, false, feedbackText);
                    this.disabled = true;
                    helpfulBtn.disabled = true;
                };
                
                feedbackButtons.appendChild(helpfulBtn);
                feedbackButtons.appendChild(notHelpfulBtn);
                
                messageElement.appendChild(feedbackButtons);
            }
            
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Guardar en historial de conversación
            aiLearningSystem.conversationHistory.push({
                id: messageId,
                text: text,
                sender: sender,
                timestamp: new Date()
            });
        }

        // Configurar arrastrar y soltar
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageUpload(files);
            }
        });

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos de aprendizaje previos
            aiLearningSystem.loadFromLocalStorage();
            
            // Configurar el primer ejercicio
            loadExercise();
            
            // Añadir mensaje de bienvenida del asistente
            setTimeout(() => {
                addMessage("Puedes subir una imagen de un problema de lógica proposicional y te ayudaré a resolverlo paso a paso.", "ai");
            }, 1000);
        });
    </script>
</body>
</html>