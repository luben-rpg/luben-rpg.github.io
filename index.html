<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador IA Avanzado - LÃ³gica Proposicional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --info: #3498db;
            --ai-bubble: #e3f2fd;
            --user-bubble: #f0f4f8;
            --learning: #9b59b6;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            grid-template-areas: 
                "header header"
                "problem assistant"
                "footer footer";
        }
        
        header {
            grid-area: header;
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: relative;
        }
        
        .learning-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--learning);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .problem-section {
            grid-area: problem;
            padding: 20px;
            background: var(--light);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .assistant-section {
            grid-area: assistant;
            padding: 20px;
            background: white;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #eee;
            position: relative;
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
        }
        
        .exercise {
            background: rgb(255, 227, 227);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .exercise-content {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid var(--secondary);
        }
        
        .input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            border-color: var(--secondary);
            outline: none;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: var(--success);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-danger {
            background: var(--accent);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-learning {
            background: var(--learning);
            color: white;
        }
        
        .btn-learning:hover {
            background: #8e44ad;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        
        .upload-area:hover {
            border-color: var(--secondary);
            background-color: #f8f9fa;
        }
        
        .upload-area.drag-over {
            border-color: var(--secondary);
            background-color: #e3f2fd;
        }
        
        .upload-icon {
            font-size: 3rem;
            color: #7f8c8d;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 15px;
            border-radius: 8px;
            display: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            max-height: 400px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
        }
        
        .message {
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .ai-message {
            align-self: flex-start;
            background: var(--ai-bubble);
            border-bottom-left-radius: 4px;
        }
        
        .user-message {
            align-self: flex-end;
            background: var(--user-bubble);
            border-bottom-right-radius: 4px;
        }
        
        .message-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .message-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 20px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .message-input input:focus {
            border-color: var(--secondary);
        }
        
        .send-btn {
            background: var(--secondary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .send-btn:hover {
            background: #2980b9;
        }
        
        .solution-step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .step-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .correct {
            border-left: 4px solid var(--success);
        }
        
        .incorrect {
            border-left: 4px solid var(--accent);
        }
        
        .feedback {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: #ffeaa7;
            border-left: 4px solid var(--warning);
        }
        
        .truth-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .truth-table th, .truth-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .truth-table th {
            background: var(--primary);
            color: white;
        }
        
        .truth-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .circuit-diagram {
            font-family: monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            white-space: pre;
            overflow-x: auto;
        }
        
        footer {
            grid-area: footer;
            text-align: center;
            padding: 20px;
            background: var(--dark);
            color: white;
        }
        
        .analysis-progress {
            height: 5px;
            width: 100%;
            background: #eee;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: var(--secondary);
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }
        
        .exercise-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .exercise-type-btn {
            padding: 8px 15px;
            background: #e0e0e0;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .exercise-type-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        .hint-box {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid var(--info);
        }
        
        .feedback-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        .feedback-btn {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            background: #f0f0f0;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .feedback-btn:hover {
            background: #e0e0e0;
        }
        
        .feedback-btn.helpful {
            color: var(--success);
        }
        
        .feedback-btn.not-helpful {
            color: var(--accent);
        }
        
        .suggestion-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .suggestion-chip {
            padding: 8px 15px;
            background: #e3f2fd;
            border-radius: 18px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .suggestion-chip:hover {
            background: #d0e5fc;
        }
        
        .user-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .progress-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .progress-tracker {
            flex: 1;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-value {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
        }
        
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "problem"
                    "assistant"
                    "footer";
            }
            
            .assistant-section {
                border-left: none;
                border-top: 1px solid #eee;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
        
        .typing-indicator {
            display: flex;
            padding: 10px;
            background: var(--ai-bubble);
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 10px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            margin: 0 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        .learning-notice {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--learning);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s;
        }
        
        .learning-notice.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="learning-badge">
                <i class="fas fa-brain"></i> IA con Aprendizaje
            </div>
            <h1><i class="fas fa-robot"></i> Analizador IA Avanzado - LÃ³gica Proposicional</h1>
            <p class="subtitle">IA mejorada que aprende de tus interacciones y mejora sus explicaciones</p>
        </header>
        
        <div class="problem-section">
            <h2><i class="fas fa-pencil-alt"></i> Ejercicio Actual</h2>
            
            <div class="exercise-selector">
                <button class="exercise-type-btn active" onclick="changeExerciseType('basic')">BÃ¡sico</button>
                <button class="exercise-type-btn" onclick="changeExerciseType('truth-table')">Tablas de Verdad</button>
                <button class="exercise-type-btn" onclick="changeExerciseType('circuit')">Circuitos LÃ³gicos</button>
            </div>
            
            <div class="exercise">
                <h3>Problema #1 <span class="exercise-difficulty">(BÃ¡sico)</span></h3>
                <div class="exercise-content">
                    Dadas las proposiciones:
                    p: "5 es un nÃºmero primo"
                    q: "4 < 2"
                    
                    Determine el valor de verdad de:
                    p â§ q, p â¨ q, p â q
                </div>
                
                <div class="hint-box">
                    <strong><i class="fas fa-lightbulb"></i> Sugerencia:</strong> Recuerda que una conjunciÃ³n (â§) es verdadera solo cuando ambas proposiciones son verdaderas.
                </div>
            </div>
            
            <div class="input-area">
                <h3><i class="fas fa-edit"></i> Tu respuesta:</h3>
                <textarea id="userSolution" placeholder="Escribe tu soluciÃ³n paso a paso aquÃ­..."></textarea>
                
                <div class="buttons">
                    <button class="btn-primary" onclick="checkSolution()">
                        <i class="fas fa-check-circle"></i> Verificar soluciÃ³n
                    </button>
                    <button class="btn-secondary" onclick="showSolution()">
                        <i class="fas fa-eye"></i> Mostrar soluciÃ³n
                    </button>
                    <button class="btn-warning" onclick="newExercise()">
                        <i class="fas fa-plus-circle"></i> Nuevo ejercicio
                    </button>
                    <button class="btn-learning" onclick="adaptiveExplanation()">
                        <i class="fas fa-graduation-cap"></i> ExplicaciÃ³n Adaptativa
                    </button>
                    <button class="btn-danger" onclick="clearAll()">
                        <i class="fas fa-trash"></i> Limpiar
                    </button>
                </div>
            </div>
            
            <div class="user-progress">
                <span class="progress-label">Tu progreso:</span>
                <div class="progress-tracker">
                    <div class="progress-value" id="progressValue" style="width: 0%"></div>
                </div>
                <span id="progressPercent">0%</span>
            </div>
            
            <div class="upload-area" id="uploadArea">
                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleImageUpload(this.files)">
                <div class="upload-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <p>Haz clic o arrastra una imagen de un ejercicio para analizarlo</p>
                <img id="imagePreview" class="image-preview" alt="Vista previa de la imagen">
                <div class="analysis-progress" id="progressBar">
                    <div class="progress-bar" id="progressFill"></div>
                </div>
            </div>
            
            <div class="feedback" id="feedbackSection">
                <h3><i class="fas fa-comment-dots"></i> RetroalimentaciÃ³n</h3>
                <p>AquÃ­ verÃ¡s el anÃ¡lisis de tu respuesta y correcciones si es necesario.</p>
            </div>
        </div>
        
        <div class="assistant-section">
            <div class="learning-notice" id="learningNotice">
                <i class="fas fa-sync-alt"></i> Aprendiendo de tu interacciÃ³n...
            </div>
            
            <h2><i class="fas fa-robot"></i> Asistente IA Avanzado</h2>
            
            <div class="chat-container" id="chatContainer">
                <div class="message ai-message">
                    Â¡Hola! Soy tu asistente avanzado de lÃ³gica proposicional. AnalizarÃ© tus respuestas escritas y aprenderÃ© de nuestras interacciones para mejorar mis explicaciones.
                </div>
                <div class="message ai-message">
                    Puedes escribir tus soluciones, subir imÃ¡genes de problemas o hacerme preguntas directas.
                    <div class="suggestion-chips">
                        <div class="suggestion-chip" onclick="sendSuggestion('Â¿CÃ³mo funciona la conjunciÃ³n?')">Â¿CÃ³mo funciona la conjunciÃ³n?</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('ExplÃ­came las tablas de verdad')">ExplÃ­came las tablas de verdad</div>
                        <div class="suggestion-chip" onclick="sendSuggestion('Necesito un ejemplo de circuito')">Necesito un ejemplo de circuito</div>
                    </div>
                </div>
            </div>
            
            <div class="message-input">
                <input type="text" id="userInput" placeholder="Escribe tu pregunta aquÃ­..." onkeypress="handleKeyPress(event)">
                <button class="send-btn" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <footer>
            <p>Analizador IA Avanzado de LÃ³gica Proposicional - Basado en "Fundamentos de la MatemÃ¡tica" de Jorge SÃ¡enz</p>
        </footer>
    </div>

    <script>
        // Ejercicios predefinidos por tipo
        const exercises = {
            basic: [
                {
                    id: 1,
                    content: `Dadas las proposiciones:
p: "5 es un nÃºmero primo"
q: "4 < 2"
                        
Determine el valor de verdad de:
p â§ q, p â¨ q, p â q`,
                    solution: {
                        steps: [
                            "p: '5 es un nÃºmero primo' â Verdadero (1)",
                            "q: '4 < 2' â Falso (0)",
                            "p â§ q = 1 â§ 0 = 0 (Falso)",
                            "p â¨ q = 1 â¨ 0 = 1 (Verdadero)",
                            "p â q = 1 â 0 = 0 (Falso)"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `Dadas las proposiciones:
p: "Ï es un nÃºmero racional"
q: "â4 = 2"
                        
Determine el valor de verdad de:
p â¨ q, p â§ q, Â¬p`,
                    solution: {
                        steps: [
                            "p: 'Ï es un nÃºmero racional' â Falso (0)",
                            "q: 'â4 = 2' â Verdadero (1)",
                            "p â¨ q = 0 â¨ 1 = 1 (Verdadero)",
                            "p â§ q = 0 â§ 1 = 0 (Falso)",
                            "Â¬p = Â¬0 = 1 (Verdadero)"
                        ]
                    }
                }
            ],
            "truth-table": [
                {
                    id: 1,
                    content: `Construya la tabla de verdad para la proposiciÃ³n:
(p â¨ q) â§ Â¬p`,
                    solution: {
                        steps: [
                            "Primero identificamos las variables: p, q",
                            "Construimos las columnas para p, q, p â¨ q, Â¬p, y (p â¨ q) â§ Â¬p",
                            "Completamos todas las combinaciones posibles de valores de verdad",
                            "Evaluamos p â¨ q para cada combinaciÃ³n",
                            "Evaluamos Â¬p para cada combinaciÃ³n",
                            "Finalmente evaluamos (p â¨ q) â§ Â¬p"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `Construya la tabla de verdad para la proposiciÃ³n:
(p â q) â§ (q â p)`,
                    solution: {
                        steps: [
                            "Esta expresiÃ³n es equivalente a p â q (bicondicional)",
                            "La bicondicional es verdadera cuando p y q tienen el mismo valor de verdad",
                            "Construimos la tabla con todas las combinaciones de p y q",
                            "Evaluamos p â q para cada combinaciÃ³n",
                            "Evaluamos q â p para cada combinaciÃ³n",
                            "Finalmente evaluamos la conjunciÃ³n de ambos condicionales"
                        ]
                    }
                }
            ],
            circuit: [
                {
                    id: 1,
                    content: `DiseÃ±e el circuito lÃ³gico para la expresiÃ³n:
(p â§ q) â¨ (Â¬p â§ r)`,
                    solution: {
                        steps: [
                            "Identificamos las compuertas necesarias: AND, OR y NOT",
                            "DiseÃ±amos la parte (p â§ q) con una compuerta AND",
                            "DiseÃ±amos la parte (Â¬p â§ r) con un NOT seguido de una AND",
                            "Combinamos ambas partes con una compuerta OR",
                            "Dibujamos el diagrama completo del circuito"
                        ]
                    }
                },
                {
                    id: 2,
                    content: `DiseÃ±e el circuito lÃ³gico para la expresiÃ³n:
Â¬(p â¨ q) â§ r`,
                    solution: {
                        steps: [
                            "Identificamos las compuertas necesarias: OR, NOT y AND",
                            "Primero diseÃ±amos (p â¨ q) con una compuerta OR",
                            "Aplicamos la negaciÃ³n Â¬(p â¨ q) con una compuerta NOT",
                            "Finalmente combinamos con r usando una compuerta AND",
                            "Dibujamos el diagrama completo del circuito"
                        ]
                    }
                }
            ]
        };

        // Sistema de aprendizaje de la IA
        const aiLearningSystem = {
            userKnowledge: {
                basic: { score: 0, attempts: 0, correct: 0 },
                truthTable: { score: 0, attempts: 0, correct: 0 },
                circuit: { score: 0, attempts: 0, correct: 0 }
            },
            explanationLevel: 1, // 1: BÃ¡sico, 2: Intermedio, 3: Avanzado
            userPreferences: {
                detailedExplanations: true,
                examples: true,
                visualAids: true
            },
            conversationHistory: [],
            feedbackHistory: [],
            
            // Aprender de la retroalimentaciÃ³n del usuario
            learnFromFeedback: function(messageId, wasHelpful, feedbackText = "") {
                this.feedbackHistory.push({
                    messageId,
                    wasHelpful,
                    feedbackText,
                    timestamp: new Date()
                });
                
                // Ajustar el nivel de explicaciÃ³n segÃºn la retroalimentaciÃ³n
                if (wasHelpful) {
                    this.explanationLevel = Math.min(3, this.explanationLevel + 0.1);
                    showLearningNotice("Â¡Gracias por tu feedback! Estoy mejorando mis explicaciones.");
                } else {
                    this.explanationLevel = Math.max(1, this.explanationLevel - 0.2);
                    showLearningNotice("Ajustando mis explicaciones basado en tu feedback...");
                    
                    // Si hay texto de retroalimentaciÃ³n, aprender de Ã©l
                    if (feedbackText) {
                        this.learnFromTextFeedback(feedbackText);
                    }
                }
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Aprender del texto de retroalimentaciÃ³n
            learnFromTextFeedback: function(feedbackText) {
                const lowerFeedback = feedbackText.toLowerCase();
                
                // Detectar solicitudes de mÃ¡s detalle
                if (lowerFeedback.includes("mÃ¡s detalle") || lowerFeedback.includes("explica mejor") || 
                    lowerFeedback.includes("no entiendo")) {
                    this.userPreferences.detailedExplanations = true;
                }
                
                // Detectar solicitudes de ejemplos
                if (lowerFeedback.includes("ejemplo") || lowerFeedback.includes("ejempl")) {
                    this.userPreferences.examples = true;
                }
                
                // Detectar solicitudes de ayudas visuales
                if (lowerFeedback.includes("visual") || lowerFeedback.includes("grÃ¡fico") || 
                    lowerFeedback.includes("diagrama")) {
                    this.userPreferences.visualAids = true;
                }
            },
            
            // Aprender del historial de conversaciÃ³n
            learnFromConversation: function() {
                // Analizar el historial de conversaciÃ³n para mejorar
                const lastFiveMessages = this.conversationHistory.slice(-5);
                
                // Contar preguntas del usuario
                const userQuestions = lastFiveMessages.filter(msg => msg.sender === 'user').length;
                
                // Si el usuario hace muchas preguntas, puede necesitar explicaciones mÃ¡s detalladas
                if (userQuestions >= 3) {
                    this.userPreferences.detailedExplanations = true;
                    this.explanationLevel = Math.min(3, this.explanationLevel + 0.2);
                }
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Actualizar el conocimiento del usuario
            updateUserKnowledge: function(topic, isCorrect) {
                if (!this.userKnowledge[topic]) {
                    this.userKnowledge[topic] = { score: 0, attempts: 0, correct: 0 };
                }
                
                this.userKnowledge[topic].attempts++;
                if (isCorrect) {
                    this.userKnowledge[topic].correct++;
                }
                
                this.userKnowledge[topic].score = this.userKnowledge[topic].correct / this.userKnowledge[topic].attempts;
                
                // Actualizar barra de progreso
                updateProgressBar();
                
                // Guardar en localStorage
                this.saveToLocalStorage();
            },
            
            // Obtener explicaciÃ³n adaptada al usuario
            getAdaptedExplanation: function(topic, baseExplanation) {
                let explanation = baseExplanation;
                
                // AÃ±adir mÃ¡s detalle si es necesario
                if (this.userPreferences.detailedExplanations) {
                    explanation += this.getAdditionalDetails(topic);
                }
                
                // AÃ±adir ejemplos si es necesario
                if (this.userPreferences.examples) {
                    explanation += this.getExample(topic);
                }
                
                // Ajustar segÃºn el nivel de explicaciÃ³n
                if (this.explanationLevel < 2) {
                    // ExplicaciÃ³n mÃ¡s simple
                    explanation = explanation.replace(/tÃ©rminos tÃ©cnicos/g, "conceptos")
                                             .replace(/En lÃ³gica proposicional/g, "En este tema");
                } else if (this.explanationLevel > 2) {
                    // ExplicaciÃ³n mÃ¡s avanzada
                    explanation += this.getAdvancedInsight(topic);
                }
                
                return explanation;
            },
            
            // Obtener detalles adicionales segÃºn el tema
            getAdditionalDetails: function(topic) {
                const details = {
                    basic: "\n\nRecuerda que en lÃ³gica proposicional trabajamos con valores de verdad binarios: verdadero (1) y falso (0).",
                    truthTable: "\n\nCada variable proposicional tiene dos valores posibles, por lo que para n variables necesitarÃ¡s 2^n filas en tu tabla de verdad.",
                    circuit: "\n\nLas compuertas lÃ³gicas se pueden combinar de muchas formas para crear circuitos mÃ¡s complejos que representen expresiones lÃ³gicas."
                };
                
                return details[topic] || "";
            },
            
            // Obtener ejemplos segÃºn el tema
            getExample: function(topic) {
                const examples = {
                    basic: "\n\nPor ejemplo, si p es verdadero y q es falso, entonces p â§ q es falso, pero p â¨ q es verdadero.",
                    truthTable: "\n\nPor ejemplo, para una expresiÃ³n con 2 variables, la tabla de verdad tendrÃ¡ 4 filas que representan todas las combinaciones posibles.",
                    circuit: "\n\nPor ejemplo, la expresiÃ³n p â§ q se representarÃ­a con una compuerta AND que toma las entradas p y q."
                };
                
                return examples[topic] || "";
            },
            
            // Obtener informaciÃ³n avanzada segÃºn el tema
            getAdvancedInsight: function(topic) {
                const insights = {
                    basic: "\n\nDesde una perspectiva mÃ¡s avanzada, puedes notar que el operador condicional (â) no es conmutativo, a diferencia de la conjunciÃ³n y disyunciÃ³n.",
                    truthTable: "\n\nUna perspectiva avanzada: las tablas de verdad son la base para la implementaciÃ³n de circuitos digitales y Ã¡lgebra booleana.",
                    circuit: "\n\nPerspectiva avanzada: estos circuitos lÃ³gicos son la base de los procesadores modernos y se implementan fÃ­sicamente con transistores."
                };
                
                return insights[topic] || "";
            },
            
            // Guardar en localStorage
            saveToLocalStorage: function() {
                const data = {
                    userKnowledge: this.userKnowledge,
                    explanationLevel: this.explanationLevel,
                    userPreferences: this.userPreferences,
                    feedbackHistory: this.feedbackHistory
                };
                
                localStorage.setItem('aiLearningData', JSON.stringify(data));
            },
            
            // Cargar desde localStorage
            loadFromLocalStorage: function() {
                const data = JSON.parse(localStorage.getItem('aiLearningData'));
                if (data) {
                    this.userKnowledge = data.userKnowledge || this.userKnowledge;
                    this.explanationLevel = data.explanationLevel || this.explanationLevel;
                    this.userPreferences = data.userPreferences || this.userPreferences;
                    this.feedbackHistory = data.feedbackHistory || this.feedbackHistory;
                    
                    // Actualizar barra de progreso
                    updateProgressBar();
                }
            }
        };

        let currentExerciseType = 'basic';
        let currentExerciseIndex = 0;
        let messageCounter = 0;

        // Respuestas predefinidas del asistente IA mejorado
        const aiResponses = {
            "hola": "Â¡Hola! Soy tu asistente avanzado de lÃ³gica proposicional. Puedo analizar tus respuestas escritas, explicarte conceptos y ayudarte a resolver problemas. Â¿En quÃ© necesitas ayuda?",
            "ayuda": "Puedo ayudarte con: valores de verdad, tablas de verdad, circuitos lÃ³gicos, equivalencias lÃ³gicas y mÃ¡s. TambiÃ©n puedo analizar tus respuestas escritas y proporcionarte retroalimentaciÃ³n detallada.",
            "verdad": "El valor de verdad de una proposiciÃ³n es su cualidad de ser verdadera (1) o falsa (0). En lÃ³gica proposicional, trabajamos con estos dos valores.",
            "conjuncion": "La conjunciÃ³n (p â§ q) es verdadera solo cuando ambas proposiciones son verdaderas. Su tabla de verdad es: p=1, q=1 â 1; p=1, q=0 â 0; p=0, q=1 â 0; p=0, q=0 â 0.",
            "disyuncion": "La disyunciÃ³n (p â¨ q) es falsa solo cuando ambas proposiciones son falsas. Su tabla de verdad es: p=1, q=1 â 1; p=1, q=0 â 1; p=0, q=1 â 1; p=0, q=0 â 0.",
            "condicional": "El condicional (p â q) es falso solo cuando p es verdadera y q es falsa. Su tabla de verdad es: p=1, q=1 â 1; p=1, q=0 â 0; p=0, q=1 â 1; p=0, q=0 â 1.",
            "tabla": "Una tabla de verdad muestra todos los posibles valores de verdad de una proposiciÃ³n compuesta. Para n variables, hay 2^n combinaciones posibles.",
            "circuito": "Los circuitos lÃ³gicos representan proposiciones usando compuertas AND, OR y NOT. Cada compuerta corresponde a un operador lÃ³gico especÃ­fico.",
            "default": "No estoy seguro de entender completamente. Â¿PodrÃ­as reformular tu pregunta o ser mÃ¡s especÃ­fico? Estoy aquÃ­ para ayudarte con conceptos de lÃ³gica proposicional."
        };

        // FunciÃ³n para mostrar notificaciÃ³n de aprendizaje
        function showLearningNotice(message) {
            const notice = document.getElementById('learningNotice');
            notice.textContent = message;
            notice.classList.add('show');
            
            setTimeout(() => {
                notice.classList.remove('show');
            }, 3000);
        }

        // FunciÃ³n para actualizar la barra de progreso
        function updateProgressBar() {
            const knowledge = aiLearningSystem.userKnowledge;
            let totalScore = 0;
            let totalTopics = 0;
            
            for (const topic in knowledge) {
                if (knowledge[topic].attempts > 0) {
                    totalScore += knowledge[topic].score;
                    totalTopics++;
                }
            }
            
            const overallProgress = totalTopics > 0 ? (totalScore / totalTopics) * 100 : 0;
            
            document.getElementById('progressValue').style.width = `${overallProgress}%`;
            document.getElementById('progressPercent').textContent = `${Math.round(overallProgress)}%`;
        }

        // FunciÃ³n para cambiar el tipo de ejercicio
        function changeExerciseType(type) {
            currentExerciseType = type;
            currentExerciseIndex = 0;
            
            // Actualizar botones activos
            document.querySelectorAll('.exercise-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Cargar nuevo ejercicio
            loadExercise();
            
            addMessage(`He cambiado a ejercicios de ${getExerciseTypeName(type)}. Â¿Necesitas ayuda con este tipo de problemas?`, "ai");
        }
        
        function getExerciseTypeName(type) {
            const names = {
                'basic': 'lÃ³gica bÃ¡sica',
                'truth-table': 'tablas de verdad',
                'circuit': 'circuitos lÃ³gicos'
            };
            return names[type] || type;
        }
        
        // FunciÃ³n para cargar el ejercicio actual
        function loadExercise() {
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            document.querySelector('.exercise-content').textContent = exercise.content;
            document.querySelector('.exercise-difficulty').textContent = `(${getExerciseTypeName(currentExerciseType)})`;
            
            // Limpiar feedback
            document.getElementById('feedbackSection').innerHTML = `
                <h3><i class="fas fa-comment-dots"></i> RetroalimentaciÃ³n</h3>
                <p>AquÃ­ verÃ¡s el anÃ¡lisis de tu respuesta y correcciones si es necesario.</p>
            `;
            
            // Limpiar Ã¡rea de texto
            document.getElementById('userSolution').value = '';
        }

        // FunciÃ³n mejorada para verificar la soluciÃ³n con IA avanzada
        function checkSolution() {
            const userSolution = document.getElementById('userSolution').value;
            const feedbackSection = document.getElementById('feedbackSection');
            
            if (!userSolution.trim()) {
                feedbackSection.innerHTML = `
                    <h3><i class="fas fa-exclamation-triangle"></i> RetroalimentaciÃ³n</h3>
                    <p>Por favor, escribe tu soluciÃ³n antes de verificar.</p>
                `;
                return;
            }
            
            // Mostrar indicador de typing
            showTypingIndicator();
            
            // Simular procesamiento con IA
            setTimeout(() => {
                // AnÃ¡lisis avanzado de la respuesta (simulaciÃ³n de IA mejorada)
                const exercise = exercises[currentExerciseType][currentExerciseIndex];
                let feedbackHTML = `
                    <h3><i class="fas fa-comment-dots"></i> AnÃ¡lisis Detallado de tu Respuesta</h3>
                `;
                
                // AnÃ¡lisis basado en el tipo de ejercicio
                if (currentExerciseType === 'basic') {
                    feedbackHTML += analyzeBasicSolution(userSolution, exercise);
                    // Actualizar conocimiento del usuario
                    aiLearningSystem.updateUserKnowledge('basic', true);
                } else if (currentExerciseType === 'truth-table') {
                    feedbackHTML += analyzeTruthTableSolution(userSolution, exercise);
                    aiLearningSystem.updateUserKnowledge('truthTable', true);
                } else if (currentExerciseType === 'circuit') {
                    feedbackHTML += analyzeCircuitSolution(userSolution, exercise);
                    aiLearningSystem.updateUserKnowledge('circuit', true);
                }
                
                feedbackSection.innerHTML = feedbackHTML;
                
                // AÃ±adir mensaje del asistente
                addMessage("He analizado tu soluciÃ³n en detalle. Â¿Hay algÃºn concepto especÃ­fico que te gustarÃ­a que explique mÃ¡s a fondo?", "ai");
                
                // Aprender de la conversaciÃ³n
                aiLearningSystem.learnFromConversation();
            }, 2000);
        }

        // FunciÃ³n para analizar soluciones de lÃ³gica bÃ¡sica
        function analyzeBasicSolution(userSolution, exercise) {
            let analysis = '';
            const lowerSolution = userSolution.toLowerCase();
            
            // Detectar valores de verdad correctos
            if (lowerSolution.includes("verdadero") || lowerSolution.includes("1") || lowerSolution.includes("true")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado valores verdaderos adecuadamente.</p>`;
            }
            
            if (lowerSolution.includes("falso") || lowerSolution.includes("0") || lowerSolution.includes("false")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado valores falsos adecuadamente.</p>`;
            }
            
            // Detectar operadores lÃ³gicos
            if (lowerSolution.includes("â§") || lowerSolution.includes("y") || lowerSolution.includes("conjunciÃ³n")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido la conjunciÃ³n (â§).</p>`;
            }
            
            if (lowerSolution.includes("â¨") || lowerSolution.includes("o") || lowerSolution.includes("disyunciÃ³n")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido la disyunciÃ³n (â¨).</p>`;
            }
            
            if (lowerSolution.includes("â") || lowerSolution.includes("entonces") || lowerSolution.includes("condicional")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido el condicional (â).</p>`;
            }
            
            // Detectar posibles errores
            if (!lowerSolution.includes("falso") && !lowerSolution.includes("0") && !lowerSolution.includes("false")) {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: No parece que hayas identificado valores falsos. Recuerda que p â§ q es falso cuando al menos una proposiciÃ³n es falsa.</p>`;
            }
            
            if ((lowerSolution.includes("verdadero") || lowerSolution.includes("1")) && 
                !lowerSolution.includes("falso") && !lowerSolution.includes("0")) {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Parece que solo has identificado valores verdaderos. Recuerda que en lÃ³gica proposicional hay dos valores posibles: verdadero y falso.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Siempre verifica ambos valores de verdad (verdadero y falso) para cada operaciÃ³n lÃ³gica.</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi anÃ¡lisis detectÃ³ que comprendes los conceptos bÃ¡sicos, pero debes prestar atenciÃ³n a los casos donde las proposiciones son falsas.</p>
            `;
            
            return analysis;
        }

        // FunciÃ³n para analizar soluciones de tablas de verdad
        function analyzeTruthTableSolution(userSolution, exercise) {
            let analysis = `
                <p><i class="fas fa-check-circle" style="color: var(--success);"></i> He detectado que estÃ¡s trabajando con tablas de verdad.</p>
            `;
            
            if (userSolution.includes("combinaciÃ³n") || userSolution.includes("combinaciones")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has considerado las combinaciones de valores de verdad.</p>`;
            } else {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Para tablas de verdad, es importante considerar todas las combinaciones posibles de valores de verdad.</p>`;
            }
            
            if (userSolution.includes("variable") || userSolution.includes("variables")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado las variables proposicionales.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Para n variables, una tabla de verdad tiene 2^n filas. AsegÃºrate de incluir todas las combinaciones posibles.</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi anÃ¡lisis sugiere que comprendes la estructura de las tablas de verdad, pero debes verificar que hayas incluido todas las combinaciones posibles.</p>
            `;
            
            return analysis;
        }

        // FunciÃ³n para analizar soluciones de circuitos lÃ³gicos
        function analyzeCircuitSolution(userSolution, exercise) {
            let analysis = `
                <p><i class="fas fa-check-circle" style="color: var(--success);"></i> He detectado que estÃ¡s trabajando con circuitos lÃ³gicos.</p>
            `;
            
            if (userSolution.includes("compuerta") || userSolution.includes("compuertas")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has identificado las compuertas lÃ³gicas.</p>`;
            } else {
                analysis += `<p><i class="fas fa-exclamation-circle" style="color: var(--accent);"></i> Revisar: Para circuitos lÃ³gicos, es importante identificar las compuertas (AND, OR, NOT) correspondientes.</p>`;
            }
            
            if (userSolution.includes("AND") || userSolution.includes("OR") || userSolution.includes("NOT")) {
                analysis += `<p><i class="fas fa-check-circle" style="color: var(--success);"></i> Correcto: Has reconocido los tipos de compuertas lÃ³gicas.</p>`;
            }
            
            analysis += `
                <p><i class="fas fa-lightbulb" style="color: var(--warning);"></i> Sugerencia: Recuerda que AND representa la conjunciÃ³n (â§), OR la disyunciÃ³n (â¨) y NOT la negaciÃ³n (Â¬).</p>
                <p><i class="fas fa-star" style="color: var(--info);"></i> Mi anÃ¡lisis indica que comprendes la relaciÃ³n entre operadores lÃ³gicos y compuertas, pero asegÃºrate de verificar todas las conexiones en tu circuito.</p>
            `;
            
            return analysis;
        }

        // FunciÃ³n para mostrar la soluciÃ³n completa
        function showSolution() {
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            addMessage("Claro, aquÃ­ estÃ¡ la soluciÃ³n paso a paso para el ejercicio actual:", "ai");
            
            // Mostrar indicador de typing
            showTypingIndicator();
            
            // Mostrar pasos de soluciÃ³n despuÃ©s de un breve delay
            setTimeout(() => {
                exercise.solution.steps.forEach((step, index) => {
                    setTimeout(() => {
                        addMessage(step, "ai");
                        
                        // Preguntar si necesita ayuda despuÃ©s del Ãºltimo paso
                        if (index === exercise.solution.steps.length - 1) {
                            setTimeout(() => {
                                addMessage("Â¿Te quedÃ³ claro? Â¿Necesitas que explique algÃºn paso en detalle?", "ai");
                            }, 500);
                        }
                    }, (index + 1) * 800);
                });
            }, 1000);
        }

        // FunciÃ³n para generar un nuevo ejercicio
        function newExercise() {
            // Avanzar al siguiente ejercicio (circular)
            currentExerciseIndex = (currentExerciseIndex + 1) % exercises[currentExerciseType].length;
            loadExercise();
            
            addMessage(`He generado un nuevo ejercicio de ${getExerciseTypeName(currentExerciseType)}. Â¿Necesitas ayuda para resolverlo?`, "ai");
        }

        // FunciÃ³n para proporcionar una explicaciÃ³n adaptativa
        function adaptiveExplanation() {
            const exercise = exercises[currentExerciseType][currentExerciseIndex];
            let explanation = "";
            
            // Obtener explicaciÃ³n base segÃºn el tipo de ejercicio
            if (currentExerciseType === 'basic') {
                explanation = "Para resolver este ejercicio de lÃ³gica bÃ¡sica, debes seguir estos pasos:";
            } else if (currentExerciseType === 'truth-table') {
                explanation = "Para construir una tabla de verdad, sigue estos pasos:";
            } else if (currentExerciseType === 'circuit') {
                explanation = "Para diseÃ±ar un circuito lÃ³gico, considera estos pasos:";
            }
            
            // Obtener explicaciÃ³n adaptada
            explanation = aiLearningSystem.getAdaptedExplanation(currentExerciseType, explanation);
            
            // AÃ±adir los pasos de la soluciÃ³n
            explanation += "\n\n" + exercise.solution.steps.join('\n');
            
            addMessage(explanation, "ai");
        }

        // FunciÃ³n para limpiar todo
        function clearAll() {
            document.getElementById('userSolution').value = '';
            document.getElementById('feedbackSection').innerHTML = `
                <h3><i class="fas fa-comment-dots"></i> RetroalimentaciÃ³n</h3>
                <p>AquÃ­ verÃ¡s el anÃ¡lisis de tu respuesta y correcciones si es necesario.</p>
            `;
            
            addMessage("He limpiado tu Ã¡rea de trabajo. Â¿En quÃ© puedo ayudarte ahora?", "ai");
        }

        // FunciÃ³n para mostrar indicador de typing
        function showTypingIndicator() {
            const chatContainer = document.getElementById('chatContainer');
            const typingIndicator = document.createElement('div');
            typingIndicator.classList.add('typing-indicator');
            typingIndicator.id = 'typingIndicator';
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.classList.add('typing-dot');
                typingIndicator.appendChild(dot);
            }
            
            chatContainer.appendChild(typingIndicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // FunciÃ³n para ocultar indicador de typing
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // FunciÃ³n para manejar la subida de imÃ¡genes
        function handleImageUpload(files) {
            if (files.length > 0) {
                const file = files[0];
                const reader = new FileReader();
                
                // Mostrar vista previa de la imagen
                reader.onload = function(e) {
                    const preview = document.getElementById('imagePreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    
                    // Mostrar barra de progreso
                    const progressBar = document.getElementById('progressBar');
                    const progressFill = document.getElementById('progressFill');
                    progressBar.style.display = 'block';
                    
                    // Simular anÃ¡lisis progresivo
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 5;
                        progressFill.style.width = `${progress}%`;
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            simulateImageAnalysis(file);
                        }
                    }, 100);
                };
                
                reader.readAsDataURL(file);
            }
        }

        // FunciÃ³n para simular el anÃ¡lisis de imagen
        function simulateImageAnalysis(file) {
            addMessage("He recibido tu imagen. Estoy analizando el problema...", "ai");
            
            // Ocultar barra de progreso
            setTimeout(() => {
                document.getElementById('progressBar').style.display = 'none';
                
                // Simular diferentes tipos de anÃ¡lisis basados en el nombre del archivo
                const fileName = file.name.toLowerCase();
                
                if (fileName.includes("tabla") || fileName.includes("verdad")) {
                    addMessage("He detectado una tabla de verdad en tu imagen. DÃ©jame analizarla...", "ai");
                    setTimeout(() => {
                        addMessage("La tabla de verdad corresponde a la expresiÃ³n: (p â¨ q) â§ Â¬p", "ai");
                        addMessage("Â¿Te gustarÃ­a que te muestre cÃ³mo construir esta tabla paso a paso?", "ai");
                        
                        // Cambiar a ejercicios de tabla de verdad
                        changeExerciseType('truth-table');
                    }, 2000);
                } else if (fileName.includes("circuito") || fileName.includes("compuerta")) {
                    addMessage("Veo que has subido un diagrama de circuito lÃ³gico. Analizando...", "ai");
                    setTimeout(() => {
                        addMessage("El circuito corresponde a la expresiÃ³n: (p â§ q) â¨ (Â¬p â§ r)", "ai");
                        addMessage("Â¿Quieres que te explique cÃ³mo funciona este circuito?", "ai");
                        
                        // Cambiar a ejercicios de circuitos
                        changeExerciseType('circuit');
                    }, 2000);
                } else {
                    addMessage("He detectado un ejercicio de lÃ³gica proposicional en tu imagen.", "ai");
                    setTimeout(() => {
                        addMessage("Parece ser un problema que involucra valores de verdad y operaciones lÃ³gicas.", "ai");
                        addMessage("Â¿Te gustarÃ­a que te guÃ­e en la soluciÃ³n?", "ai");
                        
                        // Cambiar a ejercicios bÃ¡sicos
                        changeExerciseType('basic');
                    }, 2000);
                }
            }, 1500);
        }

        // FunciÃ³n para enviar mensaje al asistente
        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (message) {
                addMessage(message, "user");
                userInput.value = '';
                
                // Mostrar indicador de typing
                showTypingIndicator();
                
                // Simularæèè¿ç¨
                setTimeout(() => {
                    hideTypingIndicator();
                    
                    // Buscar respuesta predefinida o usar default
                    const lowerMessage = message.toLowerCase();
                    let response = aiResponses.default;
                    
                    for (const [key, value] of Object.entries(aiResponses)) {
                        if (lowerMessage.includes(key)) {
                            response = value;
                            break;
                        }
                    }
                    
                    // Adaptar la respuesta segÃºn el sistema de aprendizaje
                    response = aiLearningSystem.getAdaptedExplanation(currentExerciseType, response);
                    
                    addMessage(response, "ai");
                    
                    // Aprender de la conversaciÃ³n
                    aiLearningSystem.learnFromConversation();
                }, 1500);
            }
        }
        
        // FunciÃ³n para enviar una sugerencia predefinida
        function sendSuggestion(suggestion) {
            document.getElementById('userInput').value = suggestion;
            sendMessage();
        }
        
        // FunciÃ³n para manejar la tecla Enter en el chat
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // FunciÃ³n para aÃ±adir mensaje al chat con sistema de retroalimentaciÃ³n
        function addMessage(text, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(sender === 'ai' ? 'ai-message' : 'user-message');
            
            // AÃ±adir ID Ãºnico al mensaje para retroalimentaciÃ³n
            const messageId = `msg-${messageCounter++}`;
            messageElement.id = messageId;
            
            messageElement.textContent = text;
            
            // AÃ±adir botones de retroalimentaciÃ³n para mensajes de IA
            if (sender === 'ai') {
                const feedbackButtons = document.createElement('div');
                feedbackButtons.classList.add('feedback-buttons');
                
                const helpfulBtn = document.createElement('button');
                helpfulBtn.classList.add('feedback-btn', 'helpful');
                helpfulBtn.innerHTML = '<i class="fas fa-thumbs-up"></i> Ãtil';
                helpfulBtn.onclick = function() {
                    aiLearningSystem.learnFromFeedback(messageId, true);
                    this.disabled = true;
                    notHelpfulBtn.disabled = true;
                };
                
                const notHelpfulBtn = document.createElement('button');
                notHelpfulBtn.classList.add('feedback-btn', 'not-helpful');
                notHelpfulBtn.innerHTML = '<i class="fas fa-thumbs-down"></i> No Ãºtil';
                notHelpfulBtn.onclick = function() {
                    const feedbackText = prompt("Â¿CÃ³mo podrÃ­a mejorar mi explicaciÃ³n?");
                    aiLearningSystem.learnFromFeedback(messageId, false, feedbackText);
                    this.disabled = true;
                    helpfulBtn.disabled = true;
                };
                
                feedbackButtons.appendChild(helpfulBtn);
                feedbackButtons.appendChild(notHelpfulBtn);
                
                messageElement.appendChild(feedbackButtons);
            }
            
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Guardar en historial de conversaciÃ³n
            aiLearningSystem.conversationHistory.push({
                id: messageId,
                text: text,
                sender: sender,
                timestamp: new Date()
            });
        }

        // Configurar arrastrar y soltar
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageUpload(files);
            }
        });

        // InicializaciÃ³n
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos de aprendizaje previos
            aiLearningSystem.loadFromLocalStorage();
            
            // Configurar el primer ejercicio
            loadExercise();
            
            // AÃ±adir mensaje de bienvenida del asistente
            setTimeout(() => {
                addMessage("Puedes subir una imagen de un problema de lÃ³gica proposicional y te ayudarÃ© a resolverlo paso a paso.", "ai");
            }, 1000);
        });
    </script>
</body>
</html>